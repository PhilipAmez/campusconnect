<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Peerloom</title>
    <link rel="icon" href="/android-chrome-192x192.png" sizes="192x192" type="image/png">
    <link rel="icon" href="/android-chrome-512x512.png" sizes="512x512" type="image/png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script type="module" src="js/supabaseClient.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap');
        :root {
            --primary: #7c3aed;
            --secondary: #4f46e5;
            --accent: #a78bfa;
            --text-dark: #1f2937;
            --text-light: #64748b;
            --hover-bg: #f3f4f6;
            --transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            --bg: linear-gradient(135deg, #f3e8ff 0%, #e0e7ff 100%);
        }
        [data-theme="dark"] {
            --bg-primary: #1f2937;
            --bg-secondary: #374151;
            --text-dark: #f9fafb;
            --text-light: #9ca3af;
            --hover-bg: #4b5563;
            --primary: #7c3aed;
            --secondary: #4f46e5;
            --accent: #a78bfa;
            --bg: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        }
        body {
            background: var(--bg);
            font-family: 'Segoe UI', 'Inter', Arial, sans-serif;
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden;
            transition: background 0.5s ease, color 0.5s ease;
            margin: 0;
            padding: 0;
            /* Smooth scrolling */
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            /* Prevent pull-to-refresh on entire page */
            overscroll-behavior-y: contain;
        }
       
        /* Hide scrollbars globally */
        ::-webkit-scrollbar {
            width: 0;
            height: 0;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: transparent;
        }
        /* Firefox */
        * {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
       
        /* Splash Screen Styles */
        .splash-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(circle at top, #0a0a0a 0%, #000 100%);
            color: #fff;
            font-family: 'Great Vibes', cursive;
            display: none; /* Hidden by default */
            justify-content: center;
            align-items: center;
            z-index: 10000;
            overflow: hidden;
        }
        .snowflake {
            position: fixed;
            top: -10px;
            color: white;
            font-size: 1em;
            opacity: 0.8;
            pointer-events: none;
            animation: fall linear infinite;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
            z-index: 1;
        }
        @keyframes fall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0.7; }
        }
        .splash-screen {
            position: relative;
            width: 90%;
            max-width: 900px;
            background: linear-gradient(145deg, #000, #111);
            border-radius: 20px;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.15);
            padding: 50px 30px 70px;
            text-align: center;
            z-index: 10;
            overflow: hidden;
            animation: fadeIn 2s ease forwards;
        }
        .splash-title {
            font-size: 3rem;
            background: linear-gradient(90deg, #d4af37, #f9f295, #d4af37);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 25px rgba(255, 215, 0, 0.4);
            margin-bottom: 20px;
        }
        .splash-text {
            font-size: 1.1rem;
            color: #e0e0e0;
            line-height: 1.7;
            max-width: 700px;
            margin: 0 auto 30px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }
        .highlight {
            color: gold;
            font-weight: bold;
        }
        .enter-btn {
            padding: 14px 36px;
            font-size: 1.1rem;
            border: 2px solid gold;
            border-radius: 40px;
            background: transparent;
            color: gold;
            cursor: pointer;
            transition: all 0.4s ease;
        }
        .enter-btn:hover {
            background: gold;
            color: #000;
            box-shadow: 0 0 25px gold;
        }
        .terms {
            margin-top: 40px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            max-width: 650px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.5;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; visibility: hidden; }
        }
       
        /* Main Dashboard Styles - Initially Hidden */
        .dashboard-content {
            display: block; /* Changed from none to block */
        }
       
        /* NEW: Notification Icon Styles */
        .nav-icon {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: inherit;
        }
        .notification-badge {
            position: absolute;
            top: -2px;
            right: -4px;
            width: 10px;
            height: 10px;
            background-color: var(--danger, #ef4444);
            border-radius: 50%;
            border: 2px solid var(--bg-primary, white);
            transform: scale(0);
            transition: transform 0.2s ease-in-out;
            animation: pulse 2s infinite;
        }
        .notification-badge.visible {
            transform: scale(1);
        }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }

        /* NEW: Mobile Bottom Nav Styles (from feed.html) */
        .mobile-bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--glass-bg, rgba(255, 255, 255, 0.1));
            backdrop-filter: blur(15px);
            border-top: 1px solid var(--glass-border, rgba(255, 255, 255, 0.2));
            display: none;
            justify-content: space-evenly;
            align-items: center;
            padding: 0.5rem 0 calc(0.5rem + env(safe-area-inset-bottom, 0));
            z-index: 1001;
        }
        .mobile-bottom-nav a {
            color: var(--text-dark);
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
            opacity: 0.7;
            transition: opacity 0.2s ease, color 0.2s ease;
        }
        .mobile-bottom-nav a i { font-size: 1.1rem; margin-bottom: 0.1rem; }
        .mobile-bottom-nav a:hover,
        .mobile-bottom-nav a.active {
            opacity: 1;
            color: var(--primary);
        }
        .mobile-bottom-nav a.active i {
            transform: scale(1.1);
        }
        .mobile-bottom-nav a.active span {
            font-weight: 600;
        }

        /* Mobile-First Responsive Design */
        .navbar {
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.9), rgba(79, 70, 229, 0.9));
            backdrop-filter: blur(5px);
            padding: 0.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            transition: var(--transition);
            color: white;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
        }
        .navbar::before {
            content: '';
            position: absolute;
            top: -20%;
            left: -20%;
            width: 140%;
            height: 140%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            z-index: -1;
            opacity: 0.3;
        }
        .logo img {
            height: 28px;
            transition: transform var(--transition);
        }
        .logo img:hover {
            transform: scale(1.1);
        }
        .nav-links {
            display: none;
        }
        .nav-link {
            color: white;
            font-weight: 500;
            text-decoration: none;
            padding: 0.5rem 0.8rem;
            border-radius: 0.4rem;
            transition: background 0.2s, color 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }
        .nav-link:hover {
            background: rgba(255, 255, 255, 0.15);
            color: white;
        }
        .nav-toggle {
            display: block;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: white;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.3rem;
            transition: background var(--transition);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .nav-toggle:hover {
            background: rgba(255, 255, 255, 0.25);
        }
        .nav-links.mobile {
            display: none;
            flex-direction: column;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            position: fixed;
            top: 60px;
            display: none !important; /* NEW: Always hide the old mobile menu */
            left: 0;
            right: 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 0 0 0.7rem 0.7rem;
            padding: 1rem 0.5rem;
            z-index: 1001;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .nav-links.mobile.show {
            display: flex;
        }
        .nav-links.mobile a {
            color: #000000 !important; /* Force black text */
            padding: 0.8rem 1rem;
            border-radius: 0.4rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.7rem;
            min-width: 0;
            background: rgba(124, 58, 237, 0.05);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(124, 58, 237, 0.1);
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .nav-links.mobile a:hover {
            background: rgba(124, 58, 237, 0.1);
            color: var(--primary) !important;
            transform: translateX(5px);
            border-color: rgba(124, 58, 237, 0.3);
        }
        .nav-links.mobile a i {
            color: var(--primary);
            width: 20px;
            text-align: center;
        }
        .dashboard {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            padding: 4rem 1rem 1.5rem;
            margin-top: 0;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            min-width: 0;
            transition: filter 0.3s ease;
            /* Prevent scroll propagation */
            overscroll-behavior-y: contain;
        }
        .sidebar, .main-content, .connections {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
            /* Hide scrollbars in sections */
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            /* Prevent scroll propagation */
            overscroll-behavior-y: contain;
            /* Set max height for independent scrolling */
            max-height: calc(100vh - 5rem);
        }
        /* Prevent page scroll when scrolling inside columns */
        .sidebar:active,
        .sidebar:focus,
        .main-content:active,
        .main-content:focus,
        .connections:active,
        .connections:focus {
            overscroll-behavior-y: contain;
        }
        .sidebar, .connections {
            flex: 1 1 100%;
            max-width: 100%;
        }
        .main-content {
            flex: 1 1 100%;
            max-width: 100%;
            margin: 0;
        }
        .auth-title {
            font-style: italic;
            font-weight: 600;
            color: var(--text-dark);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 1.5rem;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            border-left: 4px solid var(--primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }
        .auth-title:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 0.8rem;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
        }
        .search-bar, .input-field, .textarea-field {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.6rem;
            background: rgba(255, 255, 255, 0.2);
            font-size: 1rem;
            color: var(--text-dark);
            transition: border 0.2s;
            font-family: inherit;
        }
        .search-bar:focus, .input-field:focus, .textarea-field:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(167, 139, 250, 0.3);
        }
        .textarea-field {
            min-height: 80px;
            resize: vertical;
        }
        .search-container {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            margin-bottom: 1rem;
        }
        .search-bar {
            flex: 1;
        }
        .btn {
            font-style: italic;
            font-weight: 400;
            color: var(--text-dark);
            padding: 0.6rem 1.2rem;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s, color 0.2s;
            white-space: nowrap;
            min-width: fit-content;
        }
        .btn:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.3);
            color: var(--primary);
        }
        /* My Active Groups button styles */
        .my-active-groups-btn {
            background: transparent !important;
            border: 2px solid var(--primary) !important;
            color: var(--primary) !important;
            font-weight: 500 !important;
            margin-bottom: 1.5rem;
            width: 100%;
            animation: pulseBorder 3s infinite ease-in-out;
        }
        @keyframes pulseBorder {
            0%, 100% {
                border-color: var(--primary);
                box-shadow: 0 0 5px rgba(124, 58, 237, 0.3);
            }
            50% {
                border-color: var(--accent);
                box-shadow: 0 0 15px rgba(167, 139, 250, 0.5);
            }
        }
        .search-btn {
            background: linear-gradient(45deg, #00c4ff, #007bff);
            border: none;
            border-radius: 0.5rem;
            padding: 0.6rem 1.2rem;
            color: white;
            transition: transform 0.2s, background 0.2s;
        }
        .search-btn:hover {
            transform: translateY(-2px);
            background: linear-gradient(45deg, #00e4ff, #009bff);
        }
        .group-item, .connection-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.8rem;
            border-radius: 0.8rem;
            transition: background 0.2s, transform 0.2s;
            flex-wrap: nowrap;
            margin-bottom: 0.8rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .group-item:hover, .connection-item:hover {
            background: rgba(237, 233, 254, 0.3);
            transform: translateX(4px);
            border-color: rgba(124, 58, 237, 0.2);
        }
        /* Professional connection items layout */
        .connection-item {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 1rem;
            align-items: center;
            min-height: 72px;
        }
        .connection-avatar {
            grid-column: 1;
            flex-shrink: 0;
        }
        .connection-info {
            grid-column: 2;
            min-width: 0;
            overflow: hidden;
        }
        .connection-actions {
            grid-column: 3;
            flex-shrink: 0;
        }
        .avatar {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            overflow: hidden;
            flex-shrink: 0;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        .avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
        }
        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }
        /* Improved Video Container for Responsive 16:9 Aspect Ratio - Single Column */
        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.2s ease;
            margin-top: 0.5rem;
        }
        .video-container:hover {
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0.5rem;
        }
        .video-grid {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        /* Pull-to-refresh styles */
        #courseList {
            position: relative;
            min-height: 400px;
        }
        .ptr-indicator {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary);
            font-size: 0.9rem;
            transition: opacity 0.3s ease;
            z-index: 10;
        }
        .ptr-indicator.show {
            display: flex;
            opacity: 1;
        }
        .ptr-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(124, 58, 237, 0.3);
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .loading {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #a78bfa;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Glassmorphism Modal */
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 1.5rem 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 2000;
            color: var(--text-dark);
            text-align: center;
            font-style: italic;
            font-size: 1.2rem;
            animation: fadeIn 0.3s ease;
        }
        .modal.show {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .blur-background {
            filter: blur(5px);
            pointer-events: none;
        }
        /* Session Active Indicator - Bottom Right Corner */
        .session-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.8rem;
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-dark);
            z-index: 999;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }
        .session-indicator.active {
            color: #10b981;
        }
        .session-indicator.warning {
            color: #f59e0b;
        }
        .session-indicator.expiring {
            color: #ef4444;
            animation: pulse 1s infinite;
        }
        .session-indicator .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
       
        /* Enhanced Mobile Responsiveness - Focus on Sharp, Smooth Scrolling */
        @media (max-width: 768px) {
            .splash-title {
                font-size: 2.2rem;
            }
            .splash-text {
                font-size: 1rem;
                padding: 0 10px;
            }
            .enter-btn {
                font-size: 1rem;
                padding: 12px 28px;
            }
            .terms {
                font-size: 0.75rem;
                padding: 0 15px;
            }
           
            .auth-title {
                font-size: 1.25rem;
                padding: 0.8rem 1.2rem;
                margin-bottom: 1rem;
            }
            .sidebar, .main-content, .connections {
                padding: 1rem;
                /* Ensure smooth touch scrolling on mobile */
                -webkit-overflow-scrolling: touch;
                scroll-behavior: smooth;
                /* Reset max-height for mobile stacking */
                max-height: none;
                height: auto;
            }
            .card {
                padding: 0.8rem;
            }
            .dashboard {
                padding: 3.5rem 0.5rem 1rem;
                gap: 1rem;
            }
            .search-container {
                flex-direction: column;
            }
            .search-bar, .btn, .search-btn {
                width: 100%;
            }
            .group-item, .connection-item {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            .avatar {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
            .session-indicator {
                bottom: 15px;
                right: 15px;
                bottom: 70px; /* Move up to avoid mobile nav bar */
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
            .video-grid {
                gap: 0.75rem;
            }
            /* NEW: Show bottom nav on mobile */
            .mobile-bottom-nav {
                display: flex;
            }
            .nav-toggle {
                display: none;
            }
            /* Pull-to-refresh on mobile */
            #courseList {
                min-height: 300px;
            }
            /* Mobile stacking order */
            .dashboard {
                flex-direction: column;
            }
            .sidebar {
                order: 1;
            }
            .main-content {
                order: 2;
            }
            .connections {
                order: 3;
            }
            /* Mobile connection items */
            .connection-item {
                grid-template-columns: auto 1fr;
                grid-template-rows: auto auto;
            }
            .connection-avatar {
                grid-column: 1;
                grid-row: 1 / span 2;
            }
            .connection-info {
                grid-column: 2;
                grid-row: 1;
            }
            .connection-actions {
                grid-column: 2;
                grid-row: 2;
                justify-self: start;
                margin-top: 0.5rem;
            }
        }
       
        @media (min-width: 1024px) {
            .dashboard {
                flex-direction: row;
            }
            .nav-links {
                display: flex;
            }
            .nav-toggle {
                display: none !important; /* NEW: Always hide hamburger icon on desktop */
            }
            /* Increased left and right column widths */
            .sidebar, .connections {
                flex: 1 1 350px; /* Increased from 300px */
                max-width: 350px;
            }
            .main-content {
                flex: 2 1 500px; /* Adjusted to maintain total ~1200px */
                max-width: 500px;
            }
        }
       
        @media (max-width: 1023px) and (min-width: 769px) {
            .navbar {
                padding: 0.5rem 0.8rem;
            }
            .nav-links {
                display: none; /* This is correct for tablet view */
            }
            .nav-toggle {
                display: block;
            }
            .nav-links.mobile {
                top: 50px;
                padding: 1rem;
                background: rgba(255, 255, 255, 0.98);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            }
            .nav-links.mobile a {
                font-size: 1rem;
                padding: 0.9rem 1rem;
                margin-bottom: 0.3rem;
                background: rgba(255, 255, 255, 0.7);
                border: 1px solid rgba(124, 58, 237, 0.15);
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
                color: #000000 !important; /* Force black text */
            }
            .nav-links.mobile a:last-child {
                margin-bottom: 0;
            }
            .dashboard {
                margin-top: 0;
                padding: 3.5rem 0.5rem 1rem;
            }
            .sidebar, .main-content, .connections {
                padding: 0.7rem;
                max-height: none;
                height: auto;
            }
            .card {
                padding: 0.9rem;
            }
            .avatar {
                width: 44px;
                height: 44px;
                font-size: 1.1rem;
            }
            .session-indicator {
                bottom: 15px;
                right: 15px;
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
            .video-grid {
                gap: 0.875rem;
            }
        }
       
        @media (max-width: 480px) {
            .navbar {
                padding: 0.3rem 0.5rem;
            }
            .logo img {
                height: 24px;
            }
            .nav-toggle {
                font-size: 1.3rem;
                padding: 0.4rem;
            }
            .nav-links.mobile {
                top: 40px;
                padding: 0.8rem;
                background: rgba(255, 255, 255, 0.98);
            }
            .nav-links.mobile a {
                font-size: 0.95rem;
                padding: 0.8rem;
                color: #000000 !important; /* Force black text */
            }
            .dashboard {
                padding: 3.2rem 0.2rem 0.5rem;
            }
            .sidebar, .main-content, .connections {
                padding: 0.5rem;
                max-height: none;
                height: auto;
            }
            .card {
                padding: 0.6rem;
            }
            .search-bar, .input-field, .textarea-field {
                padding: 0.6rem;
            }
            .btn, .search-btn {
                padding: 0.4rem 0.8rem;
            }
            .avatar {
                width: 36px;
                height: 36px;
                font-size: 0.9rem;
            }
            .modal {
                padding: 1rem 1.5rem;
                font-size: 1rem;
            }
            .session-indicator {
                bottom: 10px;
                right: 10px;
                font-size: 0.75rem;
                padding: 0.3rem 0.6rem;
            }
            .video-grid {
                gap: 0.5rem;
            }
            .auth-title {
                font-size: 1.15rem;
                padding: 0.75rem 1rem;
            }
            /* Enhanced mobile smoothness */
            body {
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
        }
       
        @media (max-width: 360px) {
            .splash-title {
                font-size: 1.8rem;
            }
            .splash-text {
                font-size: 0.9rem;
            }
            .enter-btn {
                font-size: 0.9rem;
                padding: 10px 20px;
            }
            .terms {
                font-size: 0.7rem;
            }
            .auth-title {
                font-size: 1.1rem;
                padding: 0.6rem 1rem;
            }
            .dashboard {
                padding: 3rem 0.2rem 0.5rem;
            }
        }

        /* Skeleton Loader Styles */
        .skeleton-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.8rem;
            border-radius: 0.8rem;
            margin-bottom: 0.8rem;
            background: rgba(255, 255, 255, 0.1);
            overflow: hidden;
            position: relative;
        }
        [data-theme="dark"] .skeleton-item {
            background: rgba(255, 255, 255, 0.05);
        }

        .skeleton-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: var(--hover-bg);
            flex-shrink: 0;
        }

        .skeleton-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .skeleton-line {
            height: 1rem;
            background-color: var(--hover-bg);
            border-radius: 0.25rem;
        }

        .skeleton-line.short { width: 60%; }

        .skeleton-button {
            width: 60px;
            height: 36px;
            background-color: var(--hover-bg);
            border-radius: 0.5rem;
            flex-shrink: 0;
        }

        /* Shimmer Animation */
        .skeleton-item::after {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 1.5s infinite;
        }
        [data-theme="dark"] .skeleton-item::after {
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
    </style>
</head>
<body data-theme="light">
    <!-- Splash Screen - Hidden by default -->
    <div id="splashContainer" class="splash-container">
        <div class="splash-screen" id="splash">
            <div class="splash-title">Welcome to PeerLoom ‚ú®</div>
            <div class="splash-text">
                Step into the <span class="highlight">world's most vibrant student space</span> ‚Äî where study groups, ideas, and creativity unite.<br><br>
                Create your group, invite friends, and chat instantly with <span class="highlight">PeerPal AI</span> ‚Äî your smart study companion.<br>
                Watch and post creative student content on <span class="highlight">Skrolz</span>, and grow your network while learning together.<br><br>
                üéÅ The <span class="highlight">most active group</span> with over 50 members wins <span class="highlight">exclusive PeerLoom rewards</span> every month!<br>
                Share your group link ‚Äî grow your community, boost your rank, and claim the spotlight.
            </div>
            <button class="enter-btn" onclick="enterSite()">Enter PeerLoom</button>
            <div class="terms">
                *Rewards apply to verified groups only. Members must remain active throughout the month. Engagement is based on messages, posts, and Skrolz activity. PeerLoom reserves the right to verify or disqualify inactive or spam groups.
            </div>
        </div>
    </div>
    <!-- Dashboard Content - Now visible by default -->
    <div class="dashboard-content">
        <nav class="navbar" id="navbar">
            <a href="index.html" class="logo">
                <img src="../logo.png" alt="Peerloom" onerror="console.warn('Logo not found')">
            </a>
            <div class="nav-links" id="navLinks">
                <a href="about.html" class="nav-link"><i class="fas fa-info-circle"></i> About</a>
                <a href="profile.html" class="nav-link"><i class="fas fa-user"></i> Profile</a>
                <a href="notifications.html" class="nav-link nav-icon" id="notificationsBtnDesktop" aria-label="Notifications">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notificationBadgeDesktop"></span>
                </a>
                <a href="feed.html" class="nav-link"><i class="fas fa-scroll"></i> Skrolz</a>
                <a href="logout.html" class="nav-link" id="logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
            <div class="nav-links mobile" id="navLinksMobile">
                <a href="about.html" class="nav-link"><i class="fas fa-info-circle"></i> About</a>
                <a href="profile.html" class="nav-link"><i class="fas fa-user"></i> Profile</a>
                <a href="notifications.html" class="nav-link nav-icon" id="notificationsBtnMobile" aria-label="Notifications">
                    <i class="fas fa-bell"></i> Notifications
                    <span class="notification-badge" id="notificationBadgeMobile"></span>
                </a>
                <a href="feed.html" class="nav-link"><i class="fas fa-scroll"></i> Skrolz</a>
                <a href="logout.html" class="nav-link" id="logoutMobile"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </nav>
        <div class="dashboard lg:flex lg:flex-row">
            <!-- Left Column: Groups (search, My Active Groups button, Suggested Groups) -->
            <div class="sidebar">
                <h3 class="auth-title text-xl"><i class="fas fa-users"></i> Groups</h3>
                <div class="search-container">
                    <input type="text" id="groupSearch" class="search-bar" placeholder="Search groups..." />
                    <button class="btn search-btn" id="searchGroupsBtn">Search</button>
                </div>
                <button class="btn my-active-groups-btn" onclick="window.location.href='active-groups.html'">
                    <i class="fas fa-list"></i> My Active Groups
                </button>
                <div class="card">
                    <h4 class="text-lg font-semibold text-purple-600 flex items-center gap-2">
                        <i class="fas fa-lightbulb"></i> Suggested Groups
                    </h4>
                    <div id="suggestedGroups" class="space-y-2">
                        <!-- populated by Supabase with existing groups -->
                    </div>
                </div>
            </div>

            <!-- Middle Column: University Courses (Videos only) -->
            <div class="main-content">
                <h3 class="auth-title text-xl"><i class="fas fa-book"></i> Your Courses</h3>
                <div class="search-container">
                    <input type="text" id="courseSearch" class="search-bar" placeholder="Search educational videos..." />
                    <button class="btn search-btn" id="searchCoursesBtn">Search</button>
                    <div id="courseLoading" class="loading"></div>
                </div>
                <div id="ptrIndicator" class="ptr-indicator">
                    <div class="ptr-spinner"></div>
                    <span>Refreshing videos...</span>
                </div>
                <div id="courseList">
                    <!-- Videos will be loaded here -->
                </div>
            </div>

            <!-- Right Column: University Connections -->
            <div class="connections">
                <h3 class="auth-title text-xl"><i class="fas fa-user-plus"></i> Connections </h3>
                <div class="search-container">
                    <input type="text" id="connectionSearch" class="search-bar" placeholder="Search for coursemates..." />
                    <button class="btn search-btn" id="searchConnectionsBtn">Search</button>
                    <div id="connectionLoading" class="loading"></div>
                </div>
                <div id="connectionList">
                    <!-- Connections will be populated from Supabase -->
                </div>
            </div>
        </div>
        <!-- Session Active Indicator -->
        <div id="sessionIndicator" class="session-indicator active">
            <span class="status-dot"></span>
            <span id="sessionStatus">Session Active</span>
            <span id="sessionTimer">(59:59)</span>
        </div>
        <!-- Glassmorphism Modal -->
        <div id="notificationModal" class="modal">
            <span id="modalMessage">Group inserted</span>
        </div>
        <!-- Mobile Bottom Navigation -->
        <div class="mobile-bottom-nav">
            <a href="dashboard.html" class="active">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="feed.html">
                <i class="fas fa-scroll"></i>
                <span>Skrolz</span>
            </a>
            <a href="notifications.html" class="nav-icon">
                <i class="fas fa-bell"></i>
                <span class="notification-badge"></span>
                <span>Activity</span>
            </a>
            <a href="profile.html">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </a>
        </div>
    </div>
    <script type="module">
        import { supabase } from './js/supabaseClient.js';
       
        // NEW: Notification badge elements
        const notificationBadgeDesktop = document.getElementById('notificationBadgeDesktop');
        const notificationBadgeMobile = document.getElementById('notificationBadgeMobile');

        // Auto-logout timer (1 hour = 3600000 milliseconds)
        let logoutTimer;
        const AUTO_LOGOUT_TIME = 60 * 60 * 1000; // 1 hour in milliseconds
        let sessionUpdateInterval;
       
        // Theme persistence and snowflakes
        let snowflakeElements = [];
       
        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            if (theme === 'dark') {
                createSnowflakes();
            } else {
                removeSnowflakes();
            }
        }
       
        function createSnowflakes() {
            if (snowflakeElements.length > 0) return;
            const snowflakes = 80;
            for (let i = 0; i < snowflakes; i++) {
                const snowflake = document.createElement('div');
                snowflake.classList.add('snowflake');
                snowflake.textContent = '‚ùÑ';
                snowflake.style.left = Math.random() * 100 + 'vw';
                snowflake.style.fontSize = Math.random() * 1.5 + 0.5 + 'em';
                snowflake.style.animationDuration = Math.random() * 5 + 5 + 's';
                snowflake.style.animationDelay = Math.random() * 5 + 's';
                document.body.appendChild(snowflake);
                snowflakeElements.push(snowflake);
            }
        }
       
        function removeSnowflakes() {
            snowflakeElements.forEach(snow => snow.remove());
            snowflakeElements = [];
        }
       
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(newTheme);
        }
       
        // Swipe gesture for theme toggle
        let touchStartX = 0;
        const navbar = document.getElementById('navbar');
        if (navbar) {
            navbar.addEventListener('touchstart', (e) => {
                touchStartX = e.changedTouches[0].screenX;
            });
            navbar.addEventListener('touchend', (e) => {
                const touchEndX = e.changedTouches[0].screenX;
                const diff = touchStartX - touchEndX;
                if (Math.abs(diff) > 50) {
                    toggleTheme();
                }
            });
        }
       
        // Load theme on page load
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';

            applyTheme(savedTheme);
        }
       
        // Splash screen functions - modified to not show splash by default
        function enterSite() {
            const splashContainer = document.getElementById('splashContainer');
            const dashboardContent = document.querySelector('.dashboard-content');
           
            // Hide splash with animation
            splashContainer.style.animation = 'fadeOut 1s forwards';
           
            // Show dashboard content
            setTimeout(() => {
                splashContainer.style.display = 'none';
                dashboardContent.style.display = 'block';
               
                // Remove splash snowflakes
                removeSnowflakes();
               
                // Apply theme to dashboard
                loadTheme();
            }, 1000);
        }
       
        // Function to reset the logout timer
        function resetLogoutTimer() {
            clearTimeout(logoutTimer);
            logoutTimer = setTimeout(autoLogout, AUTO_LOGOUT_TIME);
            updateSessionIndicator();
        }
       
        // Function to update the session indicator
        function updateSessionIndicator() {
            const sessionIndicator = document.getElementById('sessionIndicator');
            const sessionStatus = document.getElementById('sessionStatus');
            const sessionTimer = document.getElementById('sessionTimer');
          
            if (!sessionIndicator || !sessionStatus || !sessionTimer) return;
          
            // Calculate remaining time
            const remainingTime = AUTO_LOGOUT_TIME - (Date.now() - (logoutTimer._idleStart || Date.now()));
            const minutes = Math.floor(remainingTime / 60000);
            const seconds = Math.floor((remainingTime % 60000) / 1000);
          
            // Format time display
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            sessionTimer.textContent = `(${timeString})`;
          
            // Update indicator style based on remaining time
            sessionIndicator.className = 'session-indicator';
            if (remainingTime > 10 * 60 * 1000) { // More than 10 minutes
                sessionIndicator.classList.add('active');
                sessionStatus.textContent = 'Session Active';
            } else if (remainingTime > 2 * 60 * 1000) { // More than 2 minutes
                sessionIndicator.classList.add('warning');
                sessionStatus.textContent = 'Session Expiring Soon';
            } else { // Less than 2 minutes
                sessionIndicator.classList.add('expiring');
                sessionStatus.textContent = 'Session About to Expire';
            }
        }
       
        // Function to automatically logout user
        async function autoLogout() {
            console.log('Auto-logging out due to inactivity');
            clearInterval(sessionUpdateInterval);
            const { error } = await supabase.auth.signOut();
            if (!error) {
                // Redirect to index.html with session timeout message
                window.location.href = 'index.html?message=session_timeout';
            }
        }
       
        // Function to setup activity listeners
        function setupActivityListeners() {
            const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'];
            events.forEach(event => {
                document.addEventListener(event, resetLogoutTimer, { passive: true });
            });
        }

        // Prevent page scroll when scrolling inside columns
        function setupColumnScrollPrevention() {
            const columns = document.querySelectorAll('.sidebar, .main-content, .connections');
            
            columns.forEach(column => {
                column.addEventListener('wheel', (e) => {
                    // Check if we've reached the top or bottom of the column
                    const isAtTop = column.scrollTop === 0;
                    const isAtBottom = column.scrollHeight - column.clientHeight <= column.scrollTop + 1;
                    
                    // If scrolling up at the top or scrolling down at the bottom, allow page scroll
                    if ((isAtTop && e.deltaY < 0) || (isAtBottom && e.deltaY > 0)) {
                        // Allow natural page scrolling
                        return;
                    }
                    
                    // Otherwise, prevent the event from bubbling to the page
                    e.stopPropagation();
                }, { passive: true });

                // For touch devices
                column.addEventListener('touchstart', (e) => {
                    column.dataset.startY = e.touches[0].clientY;
                }, { passive: true });

                column.addEventListener('touchmove', (e) => {
                    const startY = parseFloat(column.dataset.startY || '0');
                    const currentY = e.touches[0].clientY;
                    const isAtTop = column.scrollTop === 0;
                    const isAtBottom = column.scrollHeight - column.clientHeight <= column.scrollTop + 1;
                    
                    // If scrolling up at the top or scrolling down at the bottom, allow page scroll
                    if ((isAtTop && currentY > startY) || (isAtBottom && currentY < startY)) {
                        // Allow natural page scrolling
                        return;
                    }
                    
                    // Otherwise, prevent the event from bubbling to the page
                    if (e.cancelable) {
                        e.stopPropagation();
                    }
                }, { passive: false });
            });
        }
       
        // ============= NOTIFICATION PERMISSIONS & SOUNDS =============
        async function requestNotificationPermissions() {
          if ('Notification' in window && Notification.permission === 'default') {
            try {
              const permission = await Notification.requestPermission();
              console.log('Notification permission:', permission);
            } catch (error) {
              console.log('Notification permission request failed:', error);
            }
          }
        }

        function playNotificationSound() {
          // Use Web Audio API to create a simple notification sound
          try {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
          } catch (error) {
            console.log('Notification sound error:', error);
          }
        }

        function showNotification(message, type = 'info') {
          // Show in-app toast notification
          const toast = document.createElement('div');
          toast.style.cssText = 'position: fixed; bottom: 20px; right: 20px; background: rgba(0, 0, 0, 0.8); color: white; padding: 15px 20px; border-radius: 8px; font-size: 14px; z-index: 99999; animation: slideInRight 0.3s ease; max-width: 300px;';
          toast.textContent = message;
          document.body.appendChild(toast);

          // Play sound
          playNotificationSound();

          // Send browser notification if permission granted
          if ('Notification' in window && Notification.permission === 'granted') {
            new Notification('Peerloom', {
              body: message,
              icon: '/android-chrome-192x192.png',
              tag: 'peerloom-notification',
              badge: '/android-chrome-192x192.png'
            });
          }

          setTimeout(() => {
            toast.style.opacity = '0';
            toast.style.transition = 'opacity 0.3s ease';
            setTimeout(() => {
              document.body.removeChild(toast);
            }, 300);
          }, 3000);
        }
       
        // Gate-keep the dashboard page
        document.addEventListener('DOMContentLoaded', async () => {
            // Request notification permissions on dashboard load
            requestNotificationPermissions();
            
            // Hide splash screen by default
            const splashContainer = document.getElementById('splashContainer');
            if (splashContainer) {
                splashContainer.style.display = 'none';
            }
           
            // Show dashboard content immediately
            const dashboardContent = document.querySelector('.dashboard-content');
            if (dashboardContent) {
                dashboardContent.style.display = 'block';
            }
           
            // Apply theme
            loadTheme();
           
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) {
                window.location.replace('index.html?message=session_expired');
                return;
            }
           
            console.log("User authenticated");
           
            // Setup auto-logout functionality
            resetLogoutTimer();
            setupActivityListeners();
            setupColumnScrollPrevention();
          
            // Start session indicator update interval
            sessionUpdateInterval = setInterval(updateSessionIndicator, 1000);
          
            // Load groups and connections after authentication
            loadSuggestedGroups();
            loadConnections();
            checkFollowStatus();

            loadUserNotifications(); // NEW: Load notification count

            loadDefaultVideos(); // Load default videos initially


            // Initialize pull-to-refresh
            initPullToRefresh();

            // Setup search groups functionality
            setupGroupSearch();
        });

        // Hook up both "Logout" links
        const logoutButtons = ['logout', 'logoutMobile']
            .map(id => document.getElementById(id))
            .filter(Boolean);
        logoutButtons.forEach(btn => {
            btn.addEventListener('click', async (e) => {
                e.preventDefault();
                clearTimeout(logoutTimer); // Clear the auto-logout timer
                clearInterval(sessionUpdateInterval); // Clear the session update interval
                const { error } = await supabase.auth.signOut();
                if (error) {
                    console.error('Logout failed:', error);
                    return;
                }
                window.location.href = 'index.html?message=logout_success';
            });
        });
       
        // NEW: Load user notifications from Supabase (simplified for just the count)
        async function loadUserNotifications() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) return;

            try {
                const { count, error } = await supabase
                    .from('notifications')
                    .select('*', { count: 'exact', head: true })
                    .eq('user_id', user.id)
                    .eq('read', false);

                if (error) throw error;

                if (count > 0) {
                    notificationBadgeDesktop.classList.add('visible');
                    document.querySelectorAll('.mobile-bottom-nav .notification-badge').forEach(el => el.classList.add('visible'));
                } else {
                    notificationBadgeDesktop.classList.remove('visible');
                    document.querySelectorAll('.mobile-bottom-nav .notification-badge').forEach(el => el.classList.remove('visible'));
                }
            } catch (error) { console.error('Error loading notification count:', error); }
        }

        // Burger-menu toggler with touch support
        const navToggle = document.getElementById('navToggle');
        const navLinksMobile = document.getElementById('navLinksMobile');
        if (navToggle && navLinksMobile) {
            navToggle.addEventListener('click', () => {
                navLinksMobile.classList.toggle('show');
                resetLogoutTimer();
            });
            document.addEventListener('click', (e) => { if (!navToggle.contains(e.target) && !navLinksMobile.contains(e.target)) { navLinksMobile.classList.remove('show'); } });
            navLinksMobile.addEventListener('touchmove', (e) => { e.preventDefault(); }, { passive: false });
        }

        // Load suggested groups (excluding your own and groups you're already in)
        async function loadSuggestedGroups() {
            const suggestedGroupsDiv = document.getElementById('suggestedGroups');
            if (!suggestedGroupsDiv) return;

            // Show skeleton loader
            let skeletonHTML = '';
            for (let i = 0; i < 3; i++) { // Show 3 skeleton items
                skeletonHTML += `
                    <div class="skeleton-item">
                        <div class="skeleton-avatar"></div>
                        <div class="skeleton-info">
                            <div class="skeleton-line"></div>
                            <div class="skeleton-line short"></div>
                        </div>
                        <div class="skeleton-button"></div>
                    </div>
                `;
            }
            suggestedGroupsDiv.innerHTML = skeletonHTML;

            const { data: { user } } = await supabase.auth.getUser();
            if (!user) {
                console.error('No user found');
                return;
            }
           
            // Get groups the user is already a member of
            const { data: userGroups, error: userGroupsError } = await supabase
                .from('group_members')
                .select('group_id')
                .eq('user_id', user.id);
            if (userGroupsError) {
                console.error('Error loading user groups:', userGroupsError);
                return;
            }
           
            const userGroupIds = userGroups.map(g => g.group_id);
           
            // Get groups not created by the user and not already joined
            let query = supabase
                .from('groups')
                .select('id, name, course_code, description, created_by')
                .neq('created_by', user.id);
            
            if (userGroupIds.length > 0) {
                query = query.not('id', 'in', `(${userGroupIds.join(',')})`);
            }

            const { data, error } = await query.limit(5);
              
            if (error) {
                console.error('Error loading suggested groups:', error);
                return;
            }
          
            suggestedGroupsDiv.innerHTML = '';
          
            if (data && data.length > 0) {
                data.forEach(group => {
                    const div = document.createElement('div');
                    div.className = 'group-item';
                    div.innerHTML = `
                        <div class="avatar">${group.name.charAt(0).toUpperCase()}</div>
                        <div style="flex: 1; min-width: 0;">
                            <p class="font-semibold text-gray-800 truncate">${group.name}</p>
                            <p class="text-gray-600 text-sm truncate">${group.course_code}</p>
                            ${group.description ? `<p class="text-xs text-gray-500 mt-1 truncate">${group.description}</p>` : ''}
                        </div>
                        <a href="#" class="btn join-btn" data-groupid="${group.id}" style="flex-shrink: 0;">Join</a>
                    `;
                    suggestedGroupsDiv.appendChild(div);
                });
               
                // Add join handlers
                document.querySelectorAll('.join-btn').forEach(btn => {
                    btn.addEventListener('click', async (e) => {
                        e.preventDefault();
                        resetLogoutTimer(); // Reset timer on user action
                        const groupId = btn.dataset.groupid;
                        await joinGroup(groupId, btn);
                    });
                });
            } else {
                suggestedGroupsDiv.innerHTML = '<p class="text-center text-gray-500">No suggested groups found.</p>';
            }
        }

        // Load default videos (6 videos total)
        function loadDefaultVideos() {
            const courseList = document.getElementById('courseList');
            if (!courseList) return;
            
            const videos = [
                {
                    title: 'AI 101 - College Writing',
                    videoId: '2ePf9rue1Ao',
                    icon: 'fas fa-book'
                },
                {
                    title: 'MATH 115 - Calculus I',
                    videoId: 'WUvTyaaNkzM',
                    icon: 'fas fa-calculator'
                },
                {
                    title: 'CHEM 101 - Intro to Chemistry',
                    videoId: 'FSyAehMdpyI',
                    icon: 'fas fa-flask'
                },
                {
                    title: 'CS 101 - Intro to Programming',
                    videoId: 'kqtD5dpn9C8',
                    icon: 'fas fa-code'
                },
                {
                    title: 'PHYS 101 - Physics Fundamentals',
                    videoId: 'TTHazQeM8v8',
                    icon: 'fas fa-atom'
                },
                {
                    title: 'BIO 101 - Biology Basics',
                    videoId: 'LeTKHYL6P4s',
                    icon: 'fas fa-dna'
                }
            ];
            
            const videoGrid = document.createElement('div');
            videoGrid.className = 'video-grid';
            
            videos.forEach(video => {
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <h4 class="text-lg font-semibold text-purple-600 flex items-center gap-2">
                        <i class="${video.icon}"></i> ${video.title}
                    </h4>
                    <div class="video-container">
                        <iframe src="https://www.youtube.com/embed/${video.videoId}" title="${video.title}" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                `;
                videoGrid.appendChild(div);
            });
            
            courseList.innerHTML = '';
            courseList.appendChild(videoGrid);
        }

        // Setup group search functionality
        function setupGroupSearch() {
            const searchGroupsBtn = document.getElementById('searchGroupsBtn');
            const groupSearchInput = document.getElementById('groupSearch');
            
            if (searchGroupsBtn && groupSearchInput) {
                searchGroupsBtn.addEventListener('click', searchGroups);
                groupSearchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        searchGroups();
                    }
                });
            }
        }

        // Search groups function
        async function searchGroups() {
            const searchTerm = document.getElementById('groupSearch').value.trim();
            if (!searchTerm) {
                loadSuggestedGroups();
                return;
            }

            const { data: { user } } = await supabase.auth.getUser();
            if (!user) return;

            // Get groups the user is already a member of
            const { data: userGroups, error: userGroupsError } = await supabase
                .from('group_members')
                .select('group_id')
                .eq('user_id', user.id);
            
            if (userGroupsError) {
                console.error('Error loading user groups:', userGroupsError);
                return;
            }
           
            const userGroupIds = userGroups.map(g => g.group_id);

            // Search groups by name or course code
            const { data, error } = await supabase
                .from('groups')
                .select('id, name, course_code, description, created_by')
                .neq('created_by', user.id)
                .not('id', 'in', `(${userGroupIds.join(',')})`)
                .or(`name.ilike.%${searchTerm}%,course_code.ilike.%${searchTerm}%`)
                .limit(5);

            const suggestedGroupsDiv = document.getElementById('suggestedGroups');
            if (!suggestedGroupsDiv) return;

            if (error) {
                console.error('Error searching groups:', error);
                suggestedGroupsDiv.innerHTML = '<p class="text-center text-red-500">Error searching groups.</p>';
                return;
            }

            suggestedGroupsDiv.innerHTML = '';

            if (data && data.length > 0) {
                data.forEach(group => {
                    const div = document.createElement('div');
                    div.className = 'group-item';
                    div.innerHTML = `
                        <div class="avatar">${group.name.charAt(0).toUpperCase()}</div>
                        <div style="flex: 1; min-width: 0;">
                            <p class="font-semibold text-gray-800 truncate">${group.name}</p>
                            <p class="text-gray-600 text-sm truncate">${group.course_code}</p>
                            ${group.description ? `<p class="text-xs text-gray-500 mt-1 truncate">${group.description}</p>` : ''}
                        </div>
                        <a href="#" class="btn join-btn" data-groupid="${group.id}" style="flex-shrink: 0;">Join</a>
                    `;
                    suggestedGroupsDiv.appendChild(div);
                });

                // Add join handlers
                document.querySelectorAll('.join-btn').forEach(btn => {
                    btn.addEventListener('click', async (e) => {
                        e.preventDefault();
                        resetLogoutTimer();
                        const groupId = btn.dataset.groupid;
                        await joinGroup(groupId, btn);
                    });
                });
            } else {
                suggestedGroupsDiv.innerHTML = '<p class="text-center text-gray-500">No groups found matching your search.</p>';
            }
        }
       
        // Join group function
        async function joinGroup(groupId, button) {
            const { data: { user } } = await supabase.auth.getUser();
          
            if (!user) {
                showNotification('Please log in to join groups.');
                return;
            }
           
            try {
                // First check if user is already a member
                const { data: existingMember, error: checkError } = await supabase
                    .from('group_members')
                    .select('*')
                    .eq('group_id', groupId)
                    .eq('user_id', user.id)
                    .single();
                   
                if (existingMember) {
                    showNotification('You are already a member of this group.');
                    return;
                }
               
                // INSERT with joined_at timestamp and role
                const { error } = await supabase
                    .from('group_members')
                    .insert({
                        group_id: groupId,
                        user_id: user.id,
                        joined_at: new Date().toISOString(),
                        role: 'member'
                    });
                  
                if (error) {
                    console.error('Error joining group:', error);
                  
                    if (error.code === '23505') {
                        showNotification('You are already a member of this group.');
                    } else {
                        showNotification('Failed to join group. Please try again.');
                    }
                } else {
                    showNotification('Successfully joined group!');
                  
                    // Update the suggested groups list
                    loadSuggestedGroups();
                  
                    // Disable the join button
                    if (button) {
                        button.textContent = 'Joined';
                        button.disabled = true;
                        button.style.background = '#d1d5db';
                    }
                }
            } catch (error) {
                console.error('Unexpected error joining group:', error);
                showNotification('An unexpected error occurred while joining the group.');
            }
        }
       
        // Load connections from Supabase profiles - increased to 8 for scrollability
        async function loadConnections() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) {
                console.error('No user found');
                return;
            }
           
            try {
                // Get profiles excluding current user - using profile_photo instead of avatar_url
                const { data: profiles, error } = await supabase
                    .from('profiles')
                    .select('id, full_name, status, profile_photo, username, department')
                    .neq('id', user.id)
                    .limit(8); // Increased to 8 for scrollability
                  
                if (error) {
                    console.error('Supabase error loading connections:', error);
                    throw error;
                }
               
                const connectionList = document.getElementById('connectionList');
                if (!connectionList) return;
              
                // Show skeleton loader
                let skeletonHTML = '';
                for (let i = 0; i < 4; i++) {
                    skeletonHTML += `
                        <div class="skeleton-item">
                            <div class="skeleton-avatar"></div>
                            <div class="skeleton-info">
                                <div class="skeleton-line"></div>
                                <div class="skeleton-line short"></div>
                            </div>
                            <div class="skeleton-button"></div>
                        </div>
                    `;
                }
                connectionList.innerHTML = skeletonHTML;

                connectionList.innerHTML = '';
               
                if (profiles && profiles.length > 0) {
                    // Create a list of sample departments for demonstration
                    const sampleDepartments = [
                        'Computer Science',
                        'Engineering',
                        'Business Administration',
                        'Psychology',
                        'Biology',
                        'Mathematics',
                        'Political Science',
                        'English Literature'
                    ];
                    
                    // Sample statuses
                    const sampleStatuses = ['Online', 'Active 2h ago', 'Active 1d ago', 'Active now'];
                    
                    profiles.forEach((profile, index) => {
                        const fullName = profile.full_name || `Student ${index + 1}`;
                        const status = sampleStatuses[index % sampleStatuses.length];
                        const profilePhoto = profile.profile_photo;
                        const initials = fullName.split(' ').map(n => n[0]).join('').toUpperCase();
                        const department = sampleDepartments[index % sampleDepartments.length];
                      
                        const div = document.createElement('div');
                        div.className = 'connection-item';
                        div.innerHTML = `
                            <div class="connection-avatar">
                                <div class="avatar" onclick="navigateToUserProfile('${profile.id}')">
                                    ${profilePhoto ?
                                        `<img src="${profilePhoto}" alt="${fullName}" />` :
                                        initials
                                    }
                                </div>
                            </div>
                            <div class="connection-info" style="min-width: 0;">
                                <p class="font-semibold text-gray-800 truncate">${fullName}</p>
                                <p class="text-gray-600 text-sm truncate">${department}</p>
                                <p class="text-xs text-gray-500 mt-1 truncate">${status}</p>
                            </div>
                            <div class="connection-actions">
                                <button class="btn follow-btn" data-userid="${profile.id}" style="flex-shrink: 0; padding: 0.4rem 0.8rem; font-size: 0.9rem;">Follow</button>
                            </div>
                        `;
                        connectionList.appendChild(div);
                    });
                   
                    // Add follow handlers after elements are created
                    document.querySelectorAll('.follow-btn').forEach(btn => {
                        btn.addEventListener('click', async (e) => {
                            e.preventDefault();
                            resetLogoutTimer(); // Reset timer on user action
                            const userId = btn.dataset.userid;
                            await toggleFollowUser(btn, userId);
                        });
                    });
                   
                    // Check follow status for all users
                    checkFollowStatus();
                } else {
                    // If no profiles in database, create sample connections for demonstration
                    createSampleConnections();
                }
            } catch (error) {
                console.error('Error loading connections:', error);
                createSampleConnections(); // Fallback to sample connections
            }
        }

        // Create sample connections if database is empty
        function createSampleConnections() {
            const connectionList = document.getElementById('connectionList');
            if (!connectionList) return;
            
            const sampleConnections = [
                {
                    id: 'sample1',
                    name: 'Alex Johnson',
                    department: 'Computer Science',
                    status: 'Online',
                    initials: 'AJ'
                },
                {
                    id: 'sample2',
                    name: 'Maria Rodriguez',
                    department: 'Engineering',
                    status: 'Active 2h ago',
                    initials: 'MR'
                },
                {
                    id: 'sample3',
                    name: 'James Wilson',
                    department: 'Business Administration',
                    status: 'Active 1d ago',
                    initials: 'JW'
                },
                {
                    id: 'sample4',
                    name: 'Sarah Chen',
                    department: 'Psychology',
                    status: 'Online',
                    initials: 'SC'
                },
                {
                    id: 'sample5',
                    name: 'David Kim',
                    department: 'Biology',
                    status: 'Active now',
                    initials: 'DK'
                },
                {
                    id: 'sample6',
                    name: 'Emily Parker',
                    department: 'Mathematics',
                    status: 'Online',
                    initials: 'EP'
                },
                {
                    id: 'sample7',
                    name: 'Michael Brown',
                    department: 'Political Science',
                    status: 'Active 3h ago',
                    initials: 'MB'
                },
                {
                    id: 'sample8',
                    name: 'Olivia Taylor',
                    department: 'English Literature',
                    status: 'Active now',
                    initials: 'OT'
                }
            ];
            
            connectionList.innerHTML = '';
            
            sampleConnections.forEach(connection => {
                const div = document.createElement('div');
                div.className = 'connection-item';
                div.innerHTML = `
                    <div class="connection-avatar">
                        <div class="avatar" onclick="navigateToUserProfile('${connection.id}')">
                            ${connection.initials}
                        </div>
                    </div>
                    <div class="connection-info" style="min-width: 0;">
                        <p class="font-semibold text-gray-800 truncate">${connection.name}</p>
                        <p class="text-gray-600 text-sm truncate">${connection.department}</p>
                        <p class="text-xs text-gray-500 mt-1 truncate">${connection.status}</p>
                    </div>
                    <div class="connection-actions">
                        <button class="btn follow-btn" data-userid="${connection.id}" style="flex-shrink: 0; padding: 0.4rem 0.8rem; font-size: 0.9rem;">Follow</button>
                    </div>
                `;
                connectionList.appendChild(div);
            });
            
            // Add follow handlers for sample connections
            document.querySelectorAll('.follow-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    e.preventDefault();
                    resetLogoutTimer();
                    const userId = btn.dataset.userid;
                    await toggleFollowUser(btn, userId);
                });
            });
            
            // Check follow status for sample users
            checkFollowStatus();
        }
       
        // Check follow status for all displayed users
        async function checkFollowStatus() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) return;
           
            try {
                // Get all users the current user is following
                const { data: following, error } = await supabase
                    .from('followers')
                    .select('following_id')
                    .eq('follower_id', user.id);
                   
                if (error) {
                    console.error('Error checking follow status:', error);
                    return;
                }
               
                const followingIds = following ? following.map(f => f.following_id) : [];
               
                // Update all follow buttons based on follow status
                document.querySelectorAll('.follow-btn').forEach(btn => {
                    const userId = btn.dataset.userid;
                    if (followingIds.includes(userId)) {
                        btn.textContent = 'Unfollow';
                        btn.style.background = 'rgba(239, 68, 68, 0.2)';
                        btn.style.color = '#ef4444';
                    } else {
                        btn.textContent = 'Follow';
                        btn.style.background = '';
                        btn.style.color = '';
                    }
                });
            } catch (error) {
                console.error('Error in checkFollowStatus:', error);
            }
        }
       
        // Search connections from Supabase profiles
        async function searchConnections() {
            resetLogoutTimer(); // Reset timer on user action
          
            const connectionSearch = document.getElementById('connectionSearch').value.trim();
            const connectionLoading = document.getElementById('connectionLoading');
            const connectionList = document.getElementById('connectionList');
          
            if (!connectionList) return;
          
            if (!connectionSearch) {
                // If search is empty, reload all connections
                loadConnections();
                return;
            }
           
            connectionLoading.style.display = 'block';
           
            try {
                const { data: { user } } = await supabase.auth.getUser();
                if (!user) return;
               
                const { data, error } = await supabase
                    .from('profiles')
                    .select('id, full_name, status, profile_photo, username, department')
                    .neq('id', user.id)
                    .or(`full_name.ilike.%${connectionSearch}%,username.ilike.%${connectionSearch}%,department.ilike.%${connectionSearch}%`)
                    .limit(8); // Increased to 8 for scrollability
                  
                connectionList.innerHTML = '';
               
                if (error) {
                    console.error('Supabase search error:', error);
                    throw error;
                }
               
                if (data && data.length > 0) {
                    data.forEach(profile => {
                        const fullName = profile.full_name || 'Unknown User';
                        const status = profile.status || 'Offline';
                        const profilePhoto = profile.profile_photo;
                        const initials = fullName.split(' ').map(n => n[0]).join('').toUpperCase();
                        const department = profile.department || 'No department';
                      
                        const div = document.createElement('div');
                        div.className = 'connection-item';
                        div.innerHTML = `
                            <div class="connection-avatar">
                                <div class="avatar" onclick="navigateToUserProfile('${profile.id}')">
                                    ${profilePhoto ?
                                        `<img src="${profilePhoto}" alt="${fullName}" />` :
                                        initials
                                    }
                                </div>
                            </div>
                            <div class="connection-info" style="min-width: 0;">
                                <p class="font-semibold text-gray-800 truncate">${fullName}</p>
                                <p class="text-gray-600 text-sm truncate">${department}</p>
                                <p class="text-xs text-gray-500 mt-1 truncate">${status}</p>
                            </div>
                            <div class="connection-actions">
                                <button class="btn follow-btn" data-userid="${profile.id}" style="flex-shrink: 0; padding: 0.4rem 0.8rem; font-size: 0.9rem;">Follow</button>
                            </div>
                        `;
                        connectionList.appendChild(div);
                    });
                   
                    // Add follow handlers after elements are created
                    document.querySelectorAll('.follow-btn').forEach(btn => {
                        btn.addEventListener('click', async (e) => {
                            e.preventDefault();
                            resetLogoutTimer(); // Reset timer on user action
                            const userId = btn.dataset.userid;
                            await toggleFollowUser(btn, userId);
                        });
                    });
                   
                    // Check follow status for all users
                    checkFollowStatus();
                } else {
                    connectionList.innerHTML = '<p class="text-center text-gray-500">No users found.</p>';
                }
            } catch (error) {
                console.error('Connection search error:', error);
                connectionList.innerHTML = `<p class="text-center text-red-500">Error searching users: ${error.message}</p>`;
            } finally {
                connectionLoading.style.display = 'none';
            }
        }
       
        // Search courses with YouTube API - Now only educational content
        async function searchCourses(refresh = false) {
            resetLogoutTimer(); // Reset timer on user action
          
            let courseSearch = document.getElementById('courseSearch').value.trim();
            const courseLoading = document.getElementById('courseLoading');
            const courseList = document.getElementById('courseList');
           
            if (!courseSearch && !refresh) {
                // If no search term and not a refresh, show default videos
                loadDefaultVideos();
                return;
            }
           
            // If refresh, append a random term to vary results
            if (refresh && lastSearchQuery) {
                courseSearch = lastSearchQuery;
                const randomTerms = ['tutorial', 'lecture', 'explained', 'basics', 'guide'];
                courseSearch += ' ' + randomTerms[Math.floor(Math.random() * randomTerms.length)];
            }
           
            lastSearchQuery = courseSearch;
           
            courseLoading.style.display = 'block';
           
            try {
                // Add educational keywords to focus on educational content
                const educationalKeywords = 'educational tutorial lecture course university college learning';
                const query = `${courseSearch} ${educationalKeywords}`;
                const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&maxResults=8&key=AIzaSyAj8ndzUssPrQGo6HqyTN36ZhvHNNQjpus`;
                const response = await fetch(url);
               
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
               
                const data = await response.json();
                if (data.error) throw new Error(data.error.message || 'YouTube API error');
              
                courseList.innerHTML = '';
               
                if (data.items && data.items.length > 0) {
                    // Create a single-column video list (flex column)
                    const videoGrid = document.createElement('div');
                    videoGrid.className = 'video-grid';
                   
                    // Show exactly 6 videos
                    data.items.slice(0, 6).forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'card';
                        div.innerHTML = `
                            <h4 class="text-lg font-semibold text-purple-600 flex items-center gap-2">
                                <i class="fas fa-book"></i> ${item.snippet.title}
                            </h4>
                            <div class="video-container">
                                <iframe src="https://www.youtube.com/embed/${item.id.videoId}" title="${item.snippet.title}" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                        `;
                        videoGrid.appendChild(div);
                    });
                   
                    courseList.appendChild(videoGrid);
                } else {
                    courseList.innerHTML = '<p class="text-center text-gray-500">No educational videos found.</p>';
                }
            } catch (error) {
                console.error('YouTube API error:', error.message);
                // Load default videos on error
                loadDefaultVideos();
                // Show error toast
                showNotification('Error loading videos. Showing default content.');
            } finally {
                courseLoading.style.display = 'none';
            }
        }
       
        // Pull-to-refresh implementation
        let ptrStartY = 0;
        let ptrCurrentY = 0;
        let ptrThreshold = 80; // Pixels to trigger refresh
        function initPullToRefresh() {
            const mainContent = document.querySelector('.main-content');
            const ptrIndicator = document.getElementById('ptrIndicator');
           
            if (!mainContent || !ptrIndicator) return;
           
            let isPulling = false;
           
            mainContent.addEventListener('touchstart', (e) => {
                if (mainContent.scrollTop === 0) {
                    ptrStartY = e.touches[0].clientY;
                    isPulling = true;
                }
            }, { passive: true });
           
            mainContent.addEventListener('touchmove', (e) => {
                if (!isPulling || mainContent.scrollTop > 0) return;
               
                ptrCurrentY = e.touches[0].clientY;
                const diff = ptrCurrentY - ptrStartY;
               
                if (diff > 0 && diff < ptrThreshold) {
                    // Show indicator on pull
                    ptrIndicator.style.top = `${Math.max(-50 + diff / 2, -50)}px`;
                    ptrIndicator.classList.add('show');
                }
            }, { passive: true });
           
            mainContent.addEventListener('touchend', async (e) => {
                if (!isPulling) return;
               
                isPulling = false;
                ptrIndicator.classList.remove('show');
               
                if (ptrCurrentY - ptrStartY >= ptrThreshold) {
                    // Trigger refresh
                    ptrIndicator.style.top = '-50px';
                    ptrIndicator.classList.add('show');
                    await searchCourses(true); // Refresh with variation
                    setTimeout(() => {
                        ptrIndicator.classList.remove('show');
                    }, 1500);
                }
            }, { passive: true });
        }
       
        // Toggle follow/unfollow user function using the followers table
        async function toggleFollowUser(button, userId) {
            resetLogoutTimer(); // Reset timer on user action
          
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) {
                showNotification('Please log in to follow users.');
                return;
            }
           
            try {
                // Check if already following
                const { data: existingFollow, error: checkError } = await supabase
                    .from('followers')
                    .select('*')
                    .eq('follower_id', user.id)
                    .eq('following_id', userId)
                    .single();
                   
                if (existingFollow) {
                    // Unfollow: Delete the follow relationship
                    const { error } = await supabase
                        .from('followers')
                        .delete()
                        .eq('follower_id', user.id)
                        .eq('following_id', userId);
                      
                    if (error) {
                        console.error('Error unfollowing user:', error);
                        showNotification('Failed to unfollow user. Please try again.');
                    } else {
                        button.textContent = 'Follow';
                        button.style.background = '';
                        button.style.color = '';
                        showNotification('You have unfollowed this user');
                    }
                } else {
                    // Follow: Insert follow relationship
                    const { error } = await supabase
                        .from('followers')
                        .insert({
                            follower_id: user.id,
                            following_id: userId
                        });
                      
                    if (error) {
                        console.error('Error following user:', error);
                        showNotification('Failed to follow user. Please try again.');
                    } else {
                        button.textContent = 'Unfollow';
                        button.style.background = 'rgba(239, 68, 68, 0.2)';
                        button.style.color = '#ef4444';
                        showNotification('You are now following this user');
                    }
                }
            } catch (error) {
                console.error('Unexpected error toggling follow user:', error);
                showNotification('An unexpected error occurred while following the user.');
            }
        }
       
        // Navigate to user profile (other user's profile)
        function navigateToUserProfile(userId) {
            resetLogoutTimer(); // Reset timer on user action
            window.location.href = `profile.html?userId=${userId}`;
        }
       
        // Add event listeners
        document.addEventListener('DOMContentLoaded', () => {
            const searchConnectionsBtn = document.getElementById('searchConnectionsBtn');
            if (searchConnectionsBtn) {
                searchConnectionsBtn.addEventListener('click', searchConnections);
            }
           
            const searchCoursesBtn = document.getElementById('searchCoursesBtn');
            if (searchCoursesBtn) {
                searchCoursesBtn.addEventListener('click', () => searchCourses());
            }
           
            // Add enter key support for search
            const courseSearchInput = document.getElementById('courseSearch');
            if (courseSearchInput) {
                courseSearchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        searchCourses();
                    }
                });
            }
        });
       
        // Make functions globally available
        window.joinGroup = joinGroup;
        window.toggleFollowUser = toggleFollowUser;
        window.navigateToUserProfile = navigateToUserProfile;
        window.enterSite = enterSite;
        window.toggleTheme = toggleTheme;

        // A placeholder for openUploadModal if it's not defined on this page
        if (typeof window.openUploadModal === 'undefined') {
            window.openUploadModal = function() { alert('Create post functionality is not available on this page.'); }
        }

    </script>
</body>
</html>
