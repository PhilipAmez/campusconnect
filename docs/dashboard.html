<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Peerloom</title>
    <link rel="icon" href="/android-chrome-192x192.png" sizes="192x192" type="image/png">
    <link rel="icon" href="/android-chrome-512x512.png" sizes="512x512" type="image/png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script type="module" src="js/supabaseClient.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap');
        :root {
            --primary: #7c3aed;
            --secondary: #4f46e5;
            --accent: #a78bfa;
            --text-dark: #1f2937;
            --text-light: #64748b;
            --hover-bg: #f3f4f6;
            --transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            --bg: linear-gradient(135deg, #f3e8ff 0%, #e0e7ff 100%);
        }
        [data-theme="dark"] {
            --bg-primary: #1f2937;
            --bg-secondary: #374151;
            --text-dark: #f9fafb;
            --text-light: #9ca3af;
            --hover-bg: #4b5563;
            --primary: #7c3aed;
            --secondary: #4f46e5;
            --accent: #a78bfa;
            --bg: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        }
        body {
            background: var(--bg);
            font-family: 'Segoe UI', 'Inter', Arial, sans-serif;
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden;
            transition: background 0.5s ease, color 0.5s ease;
            margin: 0;
            padding: 0;
        }
        
        /* Splash Screen Styles */
        .splash-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(circle at top, #0a0a0a 0%, #000 100%);
            color: #fff;
            font-family: 'Great Vibes', cursive;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            overflow: hidden;
        }
        .snowflake {
            position: fixed;
            top: -10px;
            color: white;
            font-size: 1em;
            opacity: 0.8;
            pointer-events: none;
            animation: fall linear infinite;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
            z-index: 1;
        }
        @keyframes fall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0.7; }
        }
        .splash-screen {
            position: relative;
            width: 90%;
            max-width: 900px;
            background: linear-gradient(145deg, #000, #111);
            border-radius: 20px;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.15);
            padding: 50px 30px 70px;
            text-align: center;
            z-index: 10;
            overflow: hidden;
            animation: fadeIn 2s ease forwards;
        }
        .splash-title {
            font-size: 3rem;
            background: linear-gradient(90deg, #d4af37, #f9f295, #d4af37);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 25px rgba(255, 215, 0, 0.4);
            margin-bottom: 20px;
        }
        .splash-text {
            font-size: 1.1rem;
            color: #e0e0e0;
            line-height: 1.7;
            max-width: 700px;
            margin: 0 auto 30px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }
        .highlight {
            color: gold;
            font-weight: bold;
        }
        .enter-btn {
            padding: 14px 36px;
            font-size: 1.1rem;
            border: 2px solid gold;
            border-radius: 40px;
            background: transparent;
            color: gold;
            cursor: pointer;
            transition: all 0.4s ease;
        }
        .enter-btn:hover {
            background: gold;
            color: #000;
            box-shadow: 0 0 25px gold;
        }
        .terms {
            margin-top: 40px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            max-width: 650px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.5;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; visibility: hidden; }
        }
        
        /* Main Dashboard Styles - Initially Hidden */
        .dashboard-content {
            display: none;
        }
        
        /* Mobile-First Responsive Design */
        .navbar {
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.9), rgba(79, 70, 229, 0.9));
            backdrop-filter: blur(5px);
            padding: 0.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            transition: var(--transition);
            color: white;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
        }
        .navbar::before {
            content: '';
            position: absolute;
            top: -20%;
            left: -20%;
            width: 140%;
            height: 140%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            z-index: -1;
            opacity: 0.3;
        }
        .logo img {
            height: 28px;
            transition: transform var(--transition);
        }
        .logo img:hover {
            transform: scale(1.1);
        }
        .nav-links {
            display: none;
        }
        .nav-link {
            color: white;
            font-weight: 500;
            text-decoration: none;
            padding: 0.5rem 0.8rem;
            border-radius: 0.4rem;
            transition: background 0.2s, color 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }
        .nav-link:hover {
            background: rgba(255, 255, 255, 0.15);
            color: white;
        }
        .nav-toggle {
            display: block;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: white;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.3rem;
            transition: background var(--transition);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .nav-toggle:hover {
            background: rgba(255, 255, 255, 0.25);
        }
        .nav-links.mobile {
            display: none;
            flex-direction: column;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 0 0 0.7rem 0.7rem;
            padding: 1rem 0.5rem;
            z-index: 1001;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .nav-links.mobile.show {
            display: flex;
        }
        .nav-links.mobile a {
            color: #000000 !important; /* Force black text */
            padding: 0.8rem 1rem;
            border-radius: 0.4rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.7rem;
            min-width: 0;
            background: rgba(124, 58, 237, 0.05);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(124, 58, 237, 0.1);
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .nav-links.mobile a:hover {
            background: rgba(124, 58, 237, 0.1);
            color: var(--primary) !important;
            transform: translateX(5px);
            border-color: rgba(124, 58, 237, 0.3);
        }
        .nav-links.mobile a i {
            color: var(--primary);
            width: 20px;
            text-align: center;
        }
        .dashboard {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            padding: 4rem 1rem 1.5rem;
            margin-top: 0;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            min-width: 0;
            transition: filter 0.3s ease;
        }
        .sidebar, .main-content, .connections {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
        }
        .sidebar, .connections {
            flex: 1 1 100%;
            max-width: 100%;
        }
        .main-content {
            flex: 1 1 100%;
            max-width: 100%;
            margin: 0;
        }
        .auth-title {
            font-style: italic;
            font-weight: 600;
            color: var(--text-dark);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 1.5rem;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            border-left: 4px solid var(--primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }
        .auth-title:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 0.8rem;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
        }
        .search-bar, .input-field, .textarea-field {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.6rem;
            background: rgba(255, 255, 255, 0.2);
            font-size: 1rem;
            color: var(--text-dark);
            transition: border 0.2s;
            font-family: inherit;
        }
        .search-bar:focus, .input-field:focus, .textarea-field:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(167, 139, 250, 0.3);
        }
        .textarea-field {
            min-height: 80px;
            resize: vertical;
        }
        .search-container {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            margin-bottom: 1rem;
        }
        .search-bar {
            flex: 1;
        }
        .btn {
            font-style: italic;
            font-weight: 400;
            color: var(--text-dark);
            padding: 0.6rem 1.2rem;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s, color 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.3);
            color: var(--primary);
        }
        .search-btn {
            background: linear-gradient(45deg, #00c4ff, #007bff);
            border: none;
            border-radius: 0.5rem;
            padding: 0.6rem 1.2rem;
            color: white;
            transition: transform 0.2s, background 0.2s;
        }
        .search-btn:hover {
            transform: translateY(-2px);
            background: linear-gradient(45deg, #00e4ff, #009bff);
        }
        .group-item, .connection-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.6rem 0.5rem;
            border-radius: 0.6rem;
            transition: background 0.2s, transform 0.2s;
        }
        .group-item:hover, .connection-item:hover {
            background: rgba(237, 233, 254, 0.3);
            transform: translateX(4px);
        }
        .avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            overflow: hidden;
            flex-shrink: 0;
        }
        .avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }
        .video-container iframe {
            width: 100%;
            height: 150px;
            border: none;
            border-radius: 0.5rem;
        }
        .loading {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #a78bfa;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Glassmorphism Modal */
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 1.5rem 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 2000;
            color: var(--text-dark);
            text-align: center;
            font-style: italic;
            font-size: 1.2rem;
            animation: fadeIn 0.3s ease;
        }
        .modal.show {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .blur-background {
            filter: blur(5px);
            pointer-events: none;
        }
        /* Session Active Indicator - Bottom Right Corner */
        .session-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.8rem;
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-dark);
            z-index: 999;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }
        .session-indicator.active {
            color: #10b981;
        }
        .session-indicator.warning {
            color: #f59e0b;
        }
        .session-indicator.expiring {
            color: #ef4444;
            animation: pulse 1s infinite;
        }
        .session-indicator .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Enhanced Mobile Responsiveness */
        @media (max-width: 768px) {
            .splash-title {
                font-size: 2.2rem;
            }
            .splash-text {
                font-size: 1rem;
                padding: 0 10px;
            }
            .enter-btn {
                font-size: 1rem;
                padding: 12px 28px;
            }
            .terms {
                font-size: 0.75rem;
                padding: 0 15px;
            }
            
            .auth-title {
                font-size: 1.25rem;
                padding: 0.8rem 1.2rem;
                margin-bottom: 1rem;
            }
            .sidebar, .main-content, .connections {
                padding: 1rem;
            }
            .card {
                padding: 0.8rem;
            }
            .dashboard {
                padding: 3.5rem 0.5rem 1rem;
                gap: 1rem;
            }
            .search-container {
                flex-direction: column;
            }
            .search-bar, .btn, .search-btn {
                width: 100%;
            }
            .group-item, .connection-item {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            .avatar {
                width: 36px;
                height: 36px;
                font-size: 1rem;
            }
            .video-container iframe {
                height: 130px;
            }
            .session-indicator {
                bottom: 15px;
                right: 15px;
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
        }
        
        @media (min-width: 1024px) {
            .dashboard {
                flex-direction: row;
            }
            .nav-links {
                display: flex;
            }
            .nav-toggle {
                display: none;
            }
            .sidebar, .connections {
                flex: 1 1 300px;
                max-width: 300px;
            }
            .main-content {
                flex: 2 1 600px;
                max-width: 600px;
            }
        }
        
        @media (max-width: 1023px) {
            .navbar {
                padding: 0.5rem 0.8rem;
            }
            .nav-links {
                display: none;
            }
            .nav-toggle {
                display: block;
            }
            .nav-links.mobile {
                top: 50px;
                padding: 1rem;
                background: rgba(255, 255, 255, 0.98);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            }
            .nav-links.mobile a {
                font-size: 1rem;
                padding: 0.9rem 1rem;
                margin-bottom: 0.3rem;
                background: rgba(255, 255, 255, 0.7);
                border: 1px solid rgba(124, 58, 237, 0.15);
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
                color: #000000 !important; /* Force black text */
            }
            .nav-links.mobile a:last-child {
                margin-bottom: 0;
            }
            .dashboard {
                margin-top: 0;
                padding: 3.5rem 0.5rem 1rem;
            }
            .sidebar, .main-content, .connections {
                padding: 0.7rem;
            }
            .card {
                padding: 0.9rem;
            }
            .avatar {
                width: 36px;
                height: 36px;
                font-size: 1rem;
            }
            .video-container iframe {
                height: 130px;
            }
            .session-indicator {
                bottom: 15px;
                right: 15px;
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
        }
        
        @media (max-width: 480px) {
            .navbar {
                padding: 0.3rem 0.5rem;
            }
            .logo img {
                height: 24px;
            }
            .nav-toggle {
                font-size: 1.3rem;
                padding: 0.4rem;
            }
            .nav-links.mobile {
                top: 40px;
                padding: 0.8rem;
                background: rgba(255, 255, 255, 0.98);
            }
            .nav-links.mobile a {
                font-size: 0.95rem;
                padding: 0.8rem;
                color: #000000 !important; /* Force black text */
            }
            .dashboard {
                padding: 3.2rem 0.2rem 0.5rem;
            }
            .sidebar, .main-content, .connections {
                padding: 0.5rem;
            }
            .card {
                padding: 0.6rem;
            }
            .search-bar, .input-field, .textarea-field {
                padding: 0.6rem;
            }
            .btn, .search-btn {
                padding: 0.4rem 0.8rem;
            }
            .avatar {
                width: 32px;
                height: 32px;
                font-size: 0.9rem;
            }
            .video-container iframe {
                height: 110px;
            }
            .modal {
                padding: 1rem 1.5rem;
                font-size: 1rem;
            }
            .session-indicator {
                bottom: 10px;
                right: 10px;
                font-size: 0.75rem;
                padding: 0.3rem 0.6rem;
            }
        }
        
        @media (max-width: 360px) {
            .splash-title {
                font-size: 1.8rem;
            }
            .splash-text {
                font-size: 0.9rem;
            }
            .enter-btn {
                font-size: 0.9rem;
                padding: 10px 20px;
            }
            .terms {
                font-size: 0.7rem;
            }
            .auth-title {
                font-size: 1.1rem;
                padding: 0.6rem 1rem;
            }
            .dashboard {
                padding: 3rem 0.2rem 0.5rem;
            }
        }
    </style>
</head>
<body data-theme="light">
    <!-- Splash Screen - Always shown first -->
    <div id="splashContainer" class="splash-container">
        <div class="splash-screen" id="splash">
            <div class="splash-title">Welcome to PeerLoom ‚ú®</div>
            <div class="splash-text">
                Step into the <span class="highlight">world's most vibrant student space</span> ‚Äî where study groups, ideas, and creativity unite.<br><br>
                Create your group, invite friends, and chat instantly with <span class="highlight">PeerPal AI</span> ‚Äî your smart study companion.<br>
                Watch and post creative student content on <span class="highlight">Skrolz</span>, and grow your network while learning together.<br><br>
                üéÅ The <span class="highlight">most active group</span> with over 50 members wins <span class="highlight">exclusive PeerLoom rewards</span> every month!<br>
                Share your group link ‚Äî grow your community, boost your rank, and claim the spotlight.
            </div>
            <button class="enter-btn" onclick="enterSite()">Enter PeerLoom</button>
            <div class="terms">
                *Rewards apply to verified groups only. Members must remain active throughout the month. Engagement is based on messages, posts, and Skrolz activity. PeerLoom reserves the right to verify or disqualify inactive or spam groups.
            </div>
        </div>
    </div>

    <!-- Dashboard Content - Hidden until splash is dismissed -->
    <div class="dashboard-content">
        <nav class="navbar" id="navbar">
            <a href="index.html" class="logo">
                <img src="../logo.png" alt="Peerloom" onerror="console.warn('Logo not found')">
            </a>
            <button class="nav-toggle" id="navToggle" aria-label="Open navigation">
                <i class="fas fa-bars"></i>
            </button>
            <div class="nav-links" id="navLinks">
                <a href="about.html" class="nav-link"><i class="fas fa-info-circle"></i> About</a>
                <a href="profile.html" class="nav-link"><i class="fas fa-user"></i> Profile</a>
                <a href="feed.html" class="nav-link"><i class="fas fa-scroll"></i> Skrolz</a>
                <a href="logout.html" class="nav-link" id="logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
            <div class="nav-links mobile" id="navLinksMobile">
                <a href="about.html" class="nav-link"><i class="fas fa-info-circle"></i> About</a>
                <a href="profile.html" class="nav-link"><i class="fas fa-user"></i> Profile</a>
                <a href="feed.html" class="nav-link"><i class="fas fa-scroll"></i> Skrolz</a>
                <a href="logout.html" class="nav-link" id="logoutMobile"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </nav>
        <div class="dashboard lg:flex lg:flex-row">
            <div class="sidebar">
                <h3 class="auth-title text-xl"><i class="fas fa-book"></i> Your University Courses</h3>
                <div class="search-container">
                    <input type="text" id="courseSearch" class="search-bar" placeholder="Search course videos..." />
                    <button class="btn search-btn" id="searchCoursesBtn">Search</button>
                    <div id="courseLoading" class="loading"></div>
                </div>
                <div id="courseList">
                    <div class="card">
                        <h4 class="text-lg font-semibold text-purple-600 flex items-center gap-2">
                            <i class="fas fa-book"></i> AI 101 - College Writing
                        </h4>
                        <div class="video-container">
                            <iframe src="https://www.youtube.com/embed/2ePf9rue1Ao" title="AI 101 Video" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        </div>
                    </div>
                    <div class="card">
                        <h4 class="text-lg font-semibold text-purple-600 flex items-center gap-2">
                            <i class="fas fa-calculator"></i> MATH 115 - Calculus I
                        </h4>
                        <div class="video-container">
                            <iframe src="https://www.youtube.com/embed/WUvTyaaNkzM" title="MATH 115 Video" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        </div>
                    </div>
                    <div class="card">
                        <h4 class="text-lg font-semibold text-purple-600 flex items-center gap-2">
                            <i class="fas fa-flask"></i> CHEM 101 - Intro to Chemistry
                        </h4>
                        <div class="video-container">
                            <iframe src="https://www.youtube.com/embed/FSyAehMdpyI" title="CHEM 101 Video" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        </div>
                    </div>
                </div>
            </div>
            <div class="main-content">
                <div class="card">
                    <h3 class="auth-title text-xl"><i class="fas fa-users"></i> Create Study Group</h3>
                    <input type="text" id="groupName" class="input-field" placeholder="Group Name" />
                    <textarea id="groupDescription" class="textarea-field" placeholder="Group Description"></textarea>
                    <input type="text" id="groupCourse" class="input-field" placeholder="Enter Course / subject" />
                    <button class="btn" onclick="createGroup()">Create Group</button>
                </div>
                <div class="card">
                    <h3 class="auth-title text-xl"><i class="fas fa-user-friends"></i> Active Study Groups</h3>
                    <div id="groupList" class="space-y-2">
                        <!-- populated by Supabase -->
                    </div>
                </div>
                <div class="card">
                    <h3 class="auth-title text-xl"><i class="fas fa-lightbulb"></i> Suggested Groups</h3>
                    <div id="suggestedGroups" class="space-y-2">
                        <!-- populated by Supabase with existing groups -->
                    </div>
                </div>
            </div>
            <div class="connections">
                <h3 class="auth-title text-xl"><i class="fas fa-user-plus"></i> University Connections</h3>
                <div class="search-container">
                    <input type="text" id="connectionSearch" class="search-bar" placeholder="Search for coursemates..." />
                    <button class="btn search-btn" id="searchConnectionsBtn">Search</button>
                    <div id="connectionLoading" class="loading"></div>
                </div>
                <div id="connectionList">
                    <!-- Connections will be populated from Supabase -->
                </div>
            </div>
        </div>
        <!-- Session Active Indicator -->
        <div id="sessionIndicator" class="session-indicator active">
            <span class="status-dot"></span>
            <span id="sessionStatus">Session Active</span>
            <span id="sessionTimer">(59:59)</span>
        </div>
        <!-- Glassmorphism Modal -->
        <div id="notificationModal" class="modal">
            <span id="modalMessage">Group inserted</span>
        </div>
    </div>

    <script type="module">
        import { supabase } from './js/supabaseClient.js';
        
        // Auto-logout timer (1 hour = 3600000 milliseconds)
        let logoutTimer;
        const AUTO_LOGOUT_TIME = 60 * 60 * 1000; // 1 hour in milliseconds
        let sessionUpdateInterval;
        
        // Theme persistence and snowflakes
        let snowflakeElements = [];
        
        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            if (theme === 'dark') {
                createSnowflakes();
            } else {
                removeSnowflakes();
            }
        }
        
        function createSnowflakes() {
            if (snowflakeElements.length > 0) return;
            const snowflakes = 80;
            for (let i = 0; i < snowflakes; i++) {
                const snowflake = document.createElement('div');
                snowflake.classList.add('snowflake');
                snowflake.textContent = '‚ùÑ';
                snowflake.style.left = Math.random() * 100 + 'vw';
                snowflake.style.fontSize = Math.random() * 1.5 + 0.5 + 'em';
                snowflake.style.animationDuration = Math.random() * 5 + 5 + 's';
                snowflake.style.animationDelay = Math.random() * 5 + 's';
                document.body.appendChild(snowflake);
                snowflakeElements.push(snowflake);
            }
        }
        
        function removeSnowflakes() {
            snowflakeElements.forEach(snow => snow.remove());
            snowflakeElements = [];
        }
        
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(newTheme);
        }
        
        // Swipe gesture for theme toggle
        let touchStartX = 0;
        const navbar = document.getElementById('navbar');
        if (navbar) {
            navbar.addEventListener('touchstart', (e) => {
                touchStartX = e.changedTouches[0].screenX;
            });
            navbar.addEventListener('touchend', (e) => {
                const touchEndX = e.changedTouches[0].screenX;
                const diff = touchStartX - touchEndX;
                if (Math.abs(diff) > 50) {
                    toggleTheme();
                }
            });
        }
        
        // Load theme on page load
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            applyTheme(savedTheme);
        }
        
        // Splash screen functions
        function enterSite() {
            const splashContainer = document.getElementById('splashContainer');
            const dashboardContent = document.querySelector('.dashboard-content');
            
            // Hide splash with animation
            splashContainer.style.animation = 'fadeOut 1s forwards';
            
            // Show dashboard content
            setTimeout(() => {
                splashContainer.style.display = 'none';
                dashboardContent.style.display = 'block';
                
                // Remove splash snowflakes
                removeSnowflakes();
                
                // Apply theme to dashboard
                loadTheme();
            }, 1000);
        }
        
        // Function to reset the logout timer
        function resetLogoutTimer() {
            clearTimeout(logoutTimer);
            logoutTimer = setTimeout(autoLogout, AUTO_LOGOUT_TIME);
            updateSessionIndicator();
        }
        
        // Function to update the session indicator
        function updateSessionIndicator() {
            const sessionIndicator = document.getElementById('sessionIndicator');
            const sessionStatus = document.getElementById('sessionStatus');
            const sessionTimer = document.getElementById('sessionTimer');
           
            if (!sessionIndicator || !sessionStatus || !sessionTimer) return;
           
            // Calculate remaining time
            const remainingTime = AUTO_LOGOUT_TIME - (Date.now() - (logoutTimer._idleStart || Date.now()));
            const minutes = Math.floor(remainingTime / 60000);
            const seconds = Math.floor((remainingTime % 60000) / 1000);
           
            // Format time display
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            sessionTimer.textContent = `(${timeString})`;
           
            // Update indicator style based on remaining time
            sessionIndicator.className = 'session-indicator';
            if (remainingTime > 10 * 60 * 1000) { // More than 10 minutes
                sessionIndicator.classList.add('active');
                sessionStatus.textContent = 'Session Active';
            } else if (remainingTime > 2 * 60 * 1000) { // More than 2 minutes
                sessionIndicator.classList.add('warning');
                sessionStatus.textContent = 'Session Expiring Soon';
            } else { // Less than 2 minutes
                sessionIndicator.classList.add('expiring');
                sessionStatus.textContent = 'Session About to Expire';
            }
        }
        
        // Function to automatically logout user
        async function autoLogout() {
            console.log('Auto-logging out due to inactivity');
            clearInterval(sessionUpdateInterval);
            const { error } = await supabase.auth.signOut();
            if (!error) {
                // Redirect to index.html with session timeout message
                window.location.href = 'index.html?message=session_timeout';
            }
        }
        
        // Function to setup activity listeners
        function setupActivityListeners() {
            const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'];
            events.forEach(event => {
                document.addEventListener(event, resetLogoutTimer, { passive: true });
            });
        }
        
        // Gate-keep the dashboard page
        document.addEventListener('DOMContentLoaded', async () => {
            // Always show splash screen first and create snowflakes
            createSnowflakes();
            
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) {
                window.location.replace('index.html?message=session_expired');
                return;
            }
            
            console.log("User authenticated");
            
            // Setup auto-logout functionality
            resetLogoutTimer();
            setupActivityListeners();
           
            // Start session indicator update interval
            sessionUpdateInterval = setInterval(updateSessionIndicator, 1000);
           
            // Load groups and connections after authentication (they'll be ready when dashboard shows)
            loadSuggestedGroups();
            loadActiveGroups();
            loadConnections();
            checkFollowStatus();
        });
        
        // Hook up both "Logout" links
        const logoutButtons = ['logout', 'logoutMobile']
            .map(id => document.getElementById(id))
            .filter(Boolean);
        logoutButtons.forEach(btn => {
            btn.addEventListener('click', async (e) => {
                e.preventDefault();
                clearTimeout(logoutTimer); // Clear the auto-logout timer
                clearInterval(sessionUpdateInterval); // Clear the session update interval
                const { error } = await supabase.auth.signOut();
                if (error) {
                    console.error('Logout failed:', error);
                    return;
                }
                window.location.href = 'index.html?message=logout_success';
            });
        });
        
        // Burger-menu toggler with touch support
        const navToggle = document.getElementById('navToggle');
        const navLinksMobile = document.getElementById('navLinksMobile');
        if (navToggle && navLinksMobile) {
            navToggle.addEventListener('click', () => {
                navLinksMobile.classList.toggle('show');
                resetLogoutTimer(); // Reset timer on navigation interaction
            });
            document.addEventListener('click', (e) => {
                if (!navToggle.contains(e.target) && !navLinksMobile.contains(e.target)) {
                    navLinksMobile.classList.remove('show');
                }
            });
            navLinksMobile.addEventListener('touchmove', (e) => {
                e.preventDefault();
            }, { passive: false });
        }
        
        // Load suggested groups (excluding your own and groups you're already in)
        async function loadSuggestedGroups() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) {
                console.error('No user found');
                return;
            }
            
            // Get groups the user is already a member of
            const { data: userGroups, error: userGroupsError } = await supabase
                .from('group_members')
                .select('group_id')
                .eq('user_id', user.id);
            if (userGroupsError) {
                console.error('Error loading user groups:', userGroupsError);
                return;
            }
            
            const userGroupIds = userGroups.map(g => g.group_id);
            
            // Get groups not created by the user and not already joined
            const { data, error } = await supabase
                .from('groups')
                .select('id, name, course_code, description, created_by')
                .neq('created_by', user.id)
                .not('id', 'in', `(${userGroupIds.join(',')})`)
                .limit(5);
               
            if (error) {
                console.error('Error loading suggested groups:', error);
                return;
            }
           
            const suggestedGroupsDiv = document.getElementById('suggestedGroups');
            if (!suggestedGroupsDiv) return;
           
            suggestedGroupsDiv.innerHTML = '';
           
            if (data && data.length > 0) {
                data.forEach(group => {
                    const div = document.createElement('div');
                    div.className = 'group-item';
                    div.innerHTML = `
                        <div class="avatar">${group.name.charAt(0).toUpperCase()}</div>
                        <div>
                            <p class="font-semibold text-gray-800">${group.name}</p>
                            <p class="text-gray-600">${group.course_code}</p>
                            ${group.description ? `<p class="text-sm text-gray-500 mt-1">${group.description}</p>` : ''}
                        </div>
                        <a href="#" class="btn join-btn" data-groupid="${group.id}">Join</a>
                    `;
                    suggestedGroupsDiv.appendChild(div);
                });
                
                // Add join handlers
                document.querySelectorAll('.join-btn').forEach(btn => {
                    btn.addEventListener('click', async (e) => {
                        e.preventDefault();
                        resetLogoutTimer(); // Reset timer on user action
                        const groupId = btn.dataset.groupid;
                        await joinGroup(groupId, btn);
                    });
                });
            } else {
                suggestedGroupsDiv.innerHTML = '<p class="text-center text-gray-500">No suggested groups found.</p>';
            }
        }
        
        // Join group function
        async function joinGroup(groupId, button) {
            const { data: { user } } = await supabase.auth.getUser();
           
            if (!user) {
                showNotification('Please log in to join groups.');
                return;
            }
            
            try {
                // First check if user is already a member
                const { data: existingMember, error: checkError } = await supabase
                    .from('group_members')
                    .select('*')
                    .eq('group_id', groupId)
                    .eq('user_id', user.id)
                    .single();
                    
                if (existingMember) {
                    showNotification('You are already a member of this group.');
                    return;
                }
                
                // INSERT with joined_at timestamp and role
                const { error } = await supabase
                    .from('group_members')
                    .insert({
                        group_id: groupId,
                        user_id: user.id,
                        joined_at: new Date().toISOString(),
                        role: 'member'
                    });
                   
                if (error) {
                    console.error('Error joining group:', error);
                   
                    if (error.code === '23505') {
                        showNotification('You are already a member of this group.');
                    } else {
                        showNotification('Failed to join group. Please try again.');
                    }
                } else {
                    showNotification('Successfully joined group!');
                   
                    // Update both lists to reflect the change
                    loadActiveGroups();
                    loadSuggestedGroups();
                   
                    // Disable the join button
                    if (button) {
                        button.textContent = 'Joined';
                        button.disabled = true;
                        button.style.background = '#d1d5db';
                    }
                }
            } catch (error) {
                console.error('Unexpected error joining group:', error);
                showNotification('An unexpected error occurred while joining the group.');
            }
        }
        
        // Load active groups for the user
        async function loadActiveGroups() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) {
                console.error('No user found');
                return;
            }
            
            const { data, error } = await supabase
                .from('group_members')
                .select('group_id')
                .eq('user_id', user.id);
               
            if (error) {
                console.error('Error loading active groups:', error);
                return;
            }
           
            const groupListDiv = document.getElementById('groupList');
            if (!groupListDiv) return;
           
            groupListDiv.innerHTML = '';
           
            if (data && data.length > 0) {
                const groupIds = data.map(m => m.group_id);
               
                for (const groupId of groupIds) {
                    const { data: groupData, error: groupError } = await supabase
                        .from('groups')
                        .select('id, name, course_code, description')
                        .eq('id', groupId)
                        .single();
                       
                    if (groupError) {
                        console.error('Error loading group details:', groupError);
                        continue;
                    }
                   
                    const div = document.createElement('div');
                    div.className = 'group-item';
                    div.innerHTML = `
                        <div class="avatar">${groupData.name.charAt(0).toUpperCase()}</div>
                        <div>
                            <p class="font-semibold text-gray-800">${groupData.name}</p>
                            <p class="text-gray-600">${groupData.course_code}</p>
                            ${groupData.description ? `<p class="text-sm text-gray-500 mt-1">${groupData.description}</p>` : ''}
                        </div>
                        <a href="chatroom.html?groupId=${groupData.id}" class="btn">Chat</a>
                    `;
                    groupListDiv.appendChild(div);
                }
            } else {
                groupListDiv.innerHTML = '<p class="text-center text-gray-500">You are not a member of any groups yet.</p>';
            }
        }
        
        // Create group
        async function createGroup() {
            resetLogoutTimer(); // Reset timer on user action
           
            const groupName = document.getElementById('groupName').value.trim();
            const groupDescription = document.getElementById('groupDescription').value.trim();
            const course = document.getElementById('groupCourse').value.trim();
            const { data: { user } } = await supabase.auth.getUser();
           
            if (!user) {
                showNotification('Please log in to create a group.');
                return;
            }
           
            if (!groupName || !course) {
                showNotification('Please fill in all required fields.');
                return;
            }
            
            try {
                // Create the group
                const { data, error } = await supabase
                    .from('groups')
                    .insert({
                        name: groupName,
                        description: groupDescription || null,
                        course_code: course,
                        created_by: user.id,
                        is_public: true
                    })
                    .select()
                    .single();
                    
                if (error) {
                    console.error('Error creating group:', error);
                    showNotification('Failed to create group. Please try again.');
                    return;
                }
                
                // Add creator as member with admin role and timestamp
                const { error: memberError } = await supabase
                    .from('group_members')
                    .insert({
                        group_id: data.id,
                        user_id: user.id,
                        joined_at: new Date().toISOString(),
                        role: 'admin'
                    });
                    
                if (memberError) {
                    console.error('Error adding creator as member:', memberError);
                    showNotification('Group created but failed to add you as member.');
                    return;
                }
                
                // Success!
                showNotification('Group created successfully!');
                document.getElementById('groupName').value = '';
                document.getElementById('groupDescription').value = '';
                document.getElementById('groupCourse').value = '';
               
                // Refresh the lists
                loadActiveGroups();
                loadSuggestedGroups();
               
            } catch (error) {
                console.error('Unexpected error creating group:', error);
                showNotification('An unexpected error occurred.');
            }
        }
        
        // Load connections from Supabase profiles
        async function loadConnections() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) {
                console.error('No user found');
                return;
            }
            
            try {
                // Get profiles excluding current user - using profile_photo instead of avatar_url
                const { data: profiles, error } = await supabase
                    .from('profiles')
                    .select('id, full_name, status, profile_photo, username, department')
                    .neq('id', user.id)
                    .limit(3); // Limit to 3 profiles only
                   
                if (error) {
                    console.error('Supabase error loading connections:', error);
                    throw error;
                }
                
                const connectionList = document.getElementById('connectionList');
                if (!connectionList) return;
               
                connectionList.innerHTML = '';
                
                if (profiles && profiles.length > 0) {
                    profiles.forEach(profile => {
                        const fullName = profile.full_name || 'Unknown User';
                        const status = profile.status || 'Offline';
                        const profilePhoto = profile.profile_photo;
                        const initials = fullName.split(' ').map(n => n[0]).join('').toUpperCase();
                        const department = profile.department || 'No department';
                       
                        const div = document.createElement('div');
                        div.className = 'connection-item';
                        div.innerHTML = `
                            <div class="avatar" onclick="navigateToUserProfile('${profile.id}')">
                                ${profilePhoto ?
                                    `<img src="${profilePhoto}" alt="${fullName}" />` :
                                    initials
                                }
                            </div>
                            <div>
                                <p class="font-semibold text-gray-800">${fullName}</p>
                                <p class="text-gray-600">${department} ‚Ä¢ ${status}</p>
                            </div>
                            <button class="btn follow-btn" data-userid="${profile.id}" style="margin-left: auto;">Follow</button>
                        `;
                        connectionList.appendChild(div);
                    });
                    
                    // Add follow handlers after elements are created
                    document.querySelectorAll('.follow-btn').forEach(btn => {
                        btn.addEventListener('click', async (e) => {
                            e.preventDefault();
                            resetLogoutTimer(); // Reset timer on user action
                            const userId = btn.dataset.userid;
                            await toggleFollowUser(btn, userId);
                        });
                    });
                    
                    // Check follow status for all users
                    checkFollowStatus();
                } else {
                    connectionList.innerHTML = '<p class="text-center text-gray-500">No users found.</p>';
                }
            } catch (error) {
                console.error('Error loading connections:', error);
                const connectionList = document.getElementById('connectionList');
                if (connectionList) {
                    connectionList.innerHTML = '<p class="text-center text-red-500">Error loading users. Please try again.</p>';
                }
            }
        }
        
        // Check follow status for all displayed users
        async function checkFollowStatus() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) return;
            
            try {
                // Get all users the current user is following
                const { data: following, error } = await supabase
                    .from('followers')
                    .select('following_id')
                    .eq('follower_id', user.id);
                    
                if (error) {
                    console.error('Error checking follow status:', error);
                    return;
                }
                
                const followingIds = following.map(f => f.following_id);
                
                // Update all follow buttons based on follow status
                document.querySelectorAll('.follow-btn').forEach(btn => {
                    const userId = btn.dataset.userid;
                    if (followingIds.includes(userId)) {
                        btn.textContent = 'Unfollow';
                        btn.style.background = 'rgba(239, 68, 68, 0.2)';
                        btn.style.color = '#ef4444';
                    } else {
                        btn.textContent = 'Follow';
                        btn.style.background = '';
                        btn.style.color = '';
                    }
                });
            } catch (error) {
                console.error('Error in checkFollowStatus:', error);
            }
        }
        
        // Search connections from Supabase profiles
        async function searchConnections() {
            resetLogoutTimer(); // Reset timer on user action
           
            const connectionSearch = document.getElementById('connectionSearch').value.trim();
            const connectionLoading = document.getElementById('connectionLoading');
            const connectionList = document.getElementById('connectionList');
           
            if (!connectionList) return;
           
            if (!connectionSearch) {
                // If search is empty, reload all connections
                loadConnections();
                return;
            }
            
            connectionLoading.style.display = 'block';
            
            try {
                const { data: { user } } = await supabase.auth.getUser();
                if (!user) return;
                
                const { data, error } = await supabase
                    .from('profiles')
                    .select('id, full_name, status, profile_photo, username, department')
                    .neq('id', user.id)
                    .or(`full_name.ilike.%${connectionSearch}%,username.ilike.%${connectionSearch}%,department.ilike.%${connectionSearch}%`)
                    .limit(3); // Limit to 3 profiles only
                   
                connectionList.innerHTML = '';
                
                if (error) {
                    console.error('Supabase search error:', error);
                    throw error;
                }
                
                if (data && data.length > 0) {
                    data.forEach(profile => {
                        const fullName = profile.full_name || 'Unknown User';
                        const status = profile.status || 'Offline';
                        const profilePhoto = profile.profile_photo;
                        const initials = fullName.split(' ').map(n => n[0]).join('').toUpperCase();
                        const department = profile.department || 'No department';
                       
                        const div = document.createElement('div');
                        div.className = 'connection-item';
                        div.innerHTML = `
                            <div class="avatar" onclick="navigateToUserProfile('${profile.id}')">
                                ${profilePhoto ?
                                    `<img src="${profilePhoto}" alt="${fullName}" />` :
                                    initials
                                }
                            </div>
                            <div>
                                <p class="font-semibold text-gray-800">${fullName}</p>
                                <p class="text-gray-600">${department} ‚Ä¢ ${status}</p>
                            </div>
                            <button class="btn follow-btn" data-userid="${profile.id}" style="margin-left: auto;">Follow</button>
                        `;
                        connectionList.appendChild(div);
                    });
                    
                    // Add follow handlers after elements are created
                    document.querySelectorAll('.follow-btn').forEach(btn => {
                        btn.addEventListener('click', async (e) => {
                            e.preventDefault();
                            resetLogoutTimer(); // Reset timer on user action
                            const userId = btn.dataset.userid;
                            await toggleFollowUser(btn, userId);
                        });
                    });
                    
                    // Check follow status for all users
                    checkFollowStatus();
                } else {
                    connectionList.innerHTML = '<p class="text-center text-gray-500">No users found.</p>';
                }
            } catch (error) {
                console.error('Connection search error:', error);
                connectionList.innerHTML = `<p class="text-center text-red-500">Error searching users: ${error.message}</p>`;
            } finally {
                connectionLoading.style.display = 'none';
            }
        }
        
        // Search courses with YouTube API
        async function searchCourses() {
            resetLogoutTimer(); // Reset timer on user action
           
            const courseSearch = document.getElementById('courseSearch').value.trim();
            const courseLoading = document.getElementById('courseLoading');
            const courseList = document.getElementById('courseList');
            
            if (!courseSearch) return;
            
            courseLoading.style.display = 'block';
            
            try {
                const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(courseSearch + ' tutorial')}&type=video&maxResults=10&key=AIzaSyBYD4r9OeZ4dsM-eXUXvXcHTsb1rBJML8Y`;
                const response = await fetch(url);
                
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const data = await response.json();
                if (data.error) throw new Error(data.error.message || 'YouTube API error');
               
                courseList.innerHTML = '';
                
                if (data.items && data.items.length > 0) {
                    data.items.slice(0, 3).forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'card';
                        div.innerHTML = `
                            <h4 class="text-lg font-semibold text-purple-600 flex items-center gap-2">
                                <i class="fas fa-book"></i> ${item.snippet.title}
                            </h4>
                            <div class="video-container">
                                <iframe src="https://www.youtube.com/embed/${item.id.videoId}" title="${item.snippet.title}" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                        `;
                        courseList.appendChild(div);
                    });
                } else {
                    courseList.innerHTML = '<p class="text-center text-gray-500">No videos found.</p>';
                }
            } catch (error) {
                console.error('Fetch error:', error.message);
                courseList.innerHTML = `<p class="text-center text-red-500">Error loading videos: ${error.message}</p>`;
            } finally {
                courseLoading.style.display = 'none';
            }
        }
        
        // Toggle follow/unfollow user function using the followers table
        async function toggleFollowUser(button, userId) {
            resetLogoutTimer(); // Reset timer on user action
           
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) {
                showNotification('Please log in to follow users.');
                return;
            }
            
            try {
                // Check if already following
                const { data: existingFollow, error: checkError } = await supabase
                    .from('followers')
                    .select('*')
                    .eq('follower_id', user.id)
                    .eq('following_id', userId)
                    .single();
                    
                if (existingFollow) {
                    // Unfollow: Delete the follow relationship
                    const { error } = await supabase
                        .from('followers')
                        .delete()
                        .eq('follower_id', user.id)
                        .eq('following_id', userId);
                       
                    if (error) {
                        console.error('Error unfollowing user:', error);
                        showNotification('Failed to unfollow user. Please try again.');
                    } else {
                        button.textContent = 'Follow';
                        button.style.background = '';
                        button.style.color = '';
                        showNotification('You have unfollowed this user');
                    }
                } else {
                    // Follow: Insert follow relationship
                    const { error } = await supabase
                        .from('followers')
                        .insert({
                            follower_id: user.id,
                            following_id: userId
                        });
                       
                    if (error) {
                        console.error('Error following user:', error);
                        showNotification('Failed to follow user. Please try again.');
                    } else {
                        button.textContent = 'Unfollow';
                        button.style.background = 'rgba(239, 68, 68, 0.2)';
                        button.style.color = '#ef4444';
                        showNotification('You are now following this user');
                    }
                }
            } catch (error) {
                console.error('Unexpected error toggling follow user:', error);
                showNotification('An unexpected error occurred while following the user.');
            }
        }
        
        // Navigate to user profile (other user's profile)
        function navigateToUserProfile(userId) {
            resetLogoutTimer(); // Reset timer on user action
            window.location.href = `profile.html?userId=${userId}`;
        }
        
        // Show notification with blur effect
        function showNotification(message, callback) {
            const modal = document.getElementById('notificationModal');
            const body = document.querySelector('.dashboard');
            const modalMessage = document.getElementById('modalMessage');
           
            if (!modal || !body || !modalMessage) return;
           
            modalMessage.textContent = message;
            modal.classList.add('show');
            body.classList.add('blur-background');
            
            setTimeout(() => {
                modal.classList.remove('show');
                body.classList.remove('blur-background');
                if (callback) callback();
            }, 3000);
        }
        
        // Add event listeners
        document.addEventListener('DOMContentLoaded', () => {
            const searchConnectionsBtn = document.getElementById('searchConnectionsBtn');
            if (searchConnectionsBtn) {
                searchConnectionsBtn.addEventListener('click', searchConnections);
            }
            
            const searchCoursesBtn = document.getElementById('searchCoursesBtn');
            if (searchCoursesBtn) {
                searchCoursesBtn.addEventListener('click', searchCourses);
            }
        });
        
        // Make functions globally available
        window.createGroup = createGroup;
        window.joinGroup = joinGroup;
        window.toggleFollowUser = toggleFollowUser;
        window.navigateToUserProfile = navigateToUserProfile;
        window.enterSite = enterSite;
        window.toggleTheme = toggleTheme;
    </script>
</body>
</html>
