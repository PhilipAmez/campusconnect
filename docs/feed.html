<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Skrolz </title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0f0f10;
    --card:#141416;
    --muted:#bfc3cc;
    --accent-1:#7bdff6;
    --accent-2:#2fb3ff;
    --accent:#6a40ff;
    --glass: rgba(255,255,255,0.05);
    --transition: 320ms cubic-bezier(.2,.9,.3,1);
  }
  html.light{
    --bg:#f6f7fa;
    --card:#fff;
    --muted:#374151;
    --glass: rgba(0,0,0,0.03);
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:'Poppins',sans-serif;
    background:var(--bg);
    color: #fff;
    -webkit-font-smoothing:antialiased;
    transition: background var(--transition), color var(--transition);
    min-height:100vh;
    overflow:auto;
  }

  /* HEADER */
  header{
    position:sticky; top:0; z-index:40;
    height:64px; display:flex; align-items:center; justify-content:center;
    background: linear-gradient(180deg, rgba(0,0,0,0.22), rgba(0,0,0,0.05));
    backdrop-filter: blur(8px) saturate(140%);
    border-bottom:1px solid rgba(255,255,255,0.03);
    transition: background var(--transition), color var(--transition), transform 220ms ease;
    user-select:none;
    touch-action: none; /* we'll handle pointer gestures */
  }
  html.light header{ background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.85)); border-bottom:1px solid rgba(0,0,0,0.06); color:#111; }
  .header-inner{ text-align:center; pointer-events:none }
  .header-title{ font-weight:700; font-size:18px; letter-spacing:0.3px }
  .header-hint{ position:absolute; right:14px; font-size:13px; opacity:0.75; pointer-events:none }

  /* FEED */
  main#feed{
    padding:20px; display:flex; flex-direction:column; align-items:center; gap:28px; padding-bottom:120px;
  }

  /* CARD / POST */
  .post{
    width:360px; height:640px; border-radius:18px; overflow:visible; position:relative;
    background:var(--card); box-shadow: 0 12px 40px rgba(2,6,23,0.55);
    transition: transform var(--transition), box-shadow var(--transition), background var(--transition);
  }
  html.light .post{ box-shadow:0 8px 28px rgba(2,6,23,0.06) }

  .post-inner{ width:100%; height:100%; border-radius:18px; overflow:hidden; position:relative; background:var(--card); }
  .post video{ width:100%; height:100%; object-fit:cover; display:block; }

  /* overlay + caption */
  .overlay{
    position:absolute; left:0; right:0; bottom:0; padding:14px; background: linear-gradient(0deg, rgba(0,0,0,0.6), transparent 40%); color:#fff;
    transition: background var(--transition), color var(--transition);
  }
  html.light .overlay{ background: linear-gradient(0deg, rgba(255,255,255,0.86), transparent 40%); color:#111; }

  .overlay h3{ margin:0 0 6px 0; font-size:14px; font-weight:600 }
  .overlay p{ margin:0; font-size:13px; color:var(--muted) }

  /* right-side icons */
  .icons{
    position:absolute; right:10px; bottom:84px; display:flex; flex-direction:column; gap:12px; align-items:center; z-index:22;
  }
  .btn{
    width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:none;cursor:pointer;
    background: rgba(255,255,255,0.06); backdrop-filter: blur(8px); color:#fff; font-size:18px; transition: transform 160ms ease, background 160ms;
  }
  .btn:active{ transform:scale(.96) }
  html.light .btn{ color:#111; background: rgba(0,0,0,0.04) }

  .like-wrap{ display:flex; flex-direction:column; align-items:center; gap:6px }
  .like-count{ font-size:12px; color:var(--muted); user-select:none }

  /* comment drawer (per-post, anchored inside post) */
  .drawer {
    position:absolute; left:8px; right:8px; bottom:8px; height:0; max-height:58%;
    border-radius:14px; overflow:hidden; display:flex; flex-direction:column; align-items:center;
    backdrop-filter: blur(14px) saturate(140%); background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
    transition: height 360ms cubic-bezier(.2,.9,.3,1), transform 320ms ease;
    z-index:26;
    pointer-events:none;
  }
  html.light .drawer{ background: linear-gradient(180deg, rgba(0,0,0,0.03), rgba(0,0,0,0.01)); color:#111 }

  .drawer.open{ height:42%; pointer-events:auto; }

  .drawer-inner{ width:100%; height:100%; display:flex; flex-direction:column; align-items:center; padding:12px 12px 8px 12px; gap:10px; box-sizing:border-box; overflow:auto; -webkit-overflow-scrolling:touch; scroll-behavior:smooth; }
  /* hide scrollbar */
  .drawer-inner::-webkit-scrollbar{ display:none }
  .drawer-inner{ -ms-overflow-style:none; scrollbar-width:none }

  .drawer-handle{ width:54px; height:6px; border-radius:6px; background: rgba(255,255,255,0.12); margin-top:6px; }
  html.light .drawer-handle{ background: rgba(0,0,0,0.08) }

  .comments-list{ display:flex; flex-direction:column; align-items:center; gap:8px; width:100%; padding-top:6px; box-sizing:border-box; }
  .comment{
    width:88%; text-align:center; padding:10px 12px; border-radius:10px; background: rgba(255,255,255,0.03); color:inherit;
    user-select:none; font-size:14px;
  }
  html.light .comment{ background: rgba(0,0,0,0.03) }

  .drawer-footer{ width:100%; display:flex; justify-content:center; gap:8px; padding:8px 0 4px; align-items:center; }
  .comment-input { display:none; width:84%; }
  .comment-input.active { display:block; }
  .comment-input input{ width:100%; padding:10px 12px; border-radius:999px; border:none; outline:none; background: rgba(255,255,255,0.06); color:#fff; }
  html.light .comment-input input{ background: rgba(0,0,0,0.04); color:#111 }
  .send-small{ padding:8px 12px; border-radius:10px; border:none; background:var(--accent); color:#fff; font-weight:600; cursor:pointer }

  /* centered heart animation (liquid fill) */
  .heart-hit{ position:absolute; pointer-events:none; width:120px; height:120px; left:50%; top:50%; transform:translate(-50%,-50%); z-index:30; opacity:0; transition: opacity 120ms linear; }
  .heart-hit.show{ opacity:1; animation: heart-pop 420ms cubic-bezier(.2,.85,.25,1); }

  @keyframes heart-pop {
    0%{ transform:translate(-50%,-50%) scale(.84); opacity:0; filter:blur(6px) }
    10%{ transform:translate(-50%,-50%) scale(1.04); opacity:1; filter:blur(0) }
    80%{ transform:translate(-50%,-50%) scale(1); opacity:1 }
    100%{ transform:translate(-50%,-50%) scale(1); opacity:0 }
  }

  /* FAB */
  .fab{ position:fixed; right:22px; bottom:22px; z-index:40; width:64px;height:64px;border-radius:50%; border:none; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:28px;
    background: linear-gradient(135deg,var(--accent), #b473ff); color:#fff; box-shadow:0 14px 40px rgba(100,40,255,0.12); transition: transform 180ms ease; }
  .fab:active{ transform:scale(.98) }

  /* responsive */
  @media (max-width:420px){
    .post{ width:92vw; height:82vh; border-radius:12px }
    .icons{ right:6px; bottom:68px }
    .drawer.open{ height:46% }
  }

  /* small utility */
  .muted{ color:var(--muted); font-size:13px }
  .center { display:flex; align-items:center; justify-content:center }
</style>
</head>
<body>
  <header id="header" aria-hidden="false">
    <div class="header-inner">
      <div class="header-title">Skrolz</div>
      <div class="header-hint">Swipe ‚Üê / ‚Üí to toggle theme</div>
    </div>
  </header>

  <main id="feed" aria-live="polite"></main>

  <button class="fab" id="fab">Ôºã</button>

  <!-- heart animation element (reused) -->
  <div id="heartHit" class="heart-hit" aria-hidden="true">
    <svg viewBox="0 0 100 100" width="120" height="120" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <defs>
        <clipPath id="heartClip2">
          <path d="M50 86s-28-18-38-30c-8-10-3-26 9-30 9-3 19 1 29 11 10-10 20-14 29-11 12 4 17 20 9 30C78 68 50 86 50 86z"/>
        </clipPath>
        <linearGradient id="blueGrad" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0%" stop-color="#7bdff6"/>
          <stop offset="100%" stop-color="#2fb3ff"/>
        </linearGradient>
      </defs>

      <!-- outline -->
      <path d="M50 86s-28-18-38-30c-8-10-3-26 9-30 9-3 19 1 29 11 10-10 20-14 29-11 12 4 17 20 9 30C78 68 50 86 50 86z"
            fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" opacity="0.9"/>

      <g clip-path="url(#heartClip2)">
        <rect id="waterRect2" x="0" y="100" width="100" height="100" fill="url(#blueGrad)"></rect>
      </g>

      <g clip-path="url(#heartClip2)">
        <path id="wave2" d="M0 80 Q20 70 40 80 T80 80 T120 80 V120 H0 Z" fill="#ffffff30"></path>
      </g>
    </svg>
  </div>

<script>
/* ---------------- SAMPLE POSTS (replace with real data or Supabase later) ---------------- */
let posts = [
  { id:'p1', user:'@charles_fx', caption:'Trust the process üíØüî•', src:'short1.mp4', likes:124, comments:['@user01: This is fire üî•'] },
  { id:'p2', user:'@peerloom', caption:'Campus vibes üëèüìö', src:'short2.mp4', likes:67, comments:['@student23: PeerLoom looks mad clean üòç'] },
  { id:'p3', user:'@ryke', caption:'Level up every week ‚è´', src:'short3.mp4', likes:21, comments:[] }
];

const feed = document.getElementById('feed');
const heartHit = document.getElementById('heartHit');

/* RENDER POSTS */
function renderFeed(){
  feed.innerHTML = '';
  posts.forEach(post => {
    const postEl = document.createElement('article');
    postEl.className = 'post';
    postEl.dataset.id = post.id;
    postEl.innerHTML = `
      <div class="post-inner">
        <video muted playsinline preload="metadata" loop src="${post.src}"></video>

        <div class="overlay">
          <h3>${post.user}</h3>
          <p>${post.caption}</p>
        </div>

        <div class="icons">
          <div class="like-wrap">
            <button class="btn like-btn" title="Like">‚ô°</button>
            <div class="like-count">${post.likes}</div>
          </div>
          <button class="btn comment-open" title="Comments">üí¨</button>
          <button class="btn share-btn" title="Share">‚ÜóÔ∏è</button>
        </div>

        <!-- drawer scoped to post -->
        <div class="drawer" aria-hidden="true">
          <div class="drawer-inner">
            <div class="drawer-handle"></div>
            <div class="muted small center" style="margin-top:4px;">Comments</div>
            <div class="comments-list" aria-live="polite"></div>
            <div class="drawer-footer">
              <div class="comment-input">
                <input placeholder="Write your comment..." />
              </div>
              <button class="send-small">Send</button>
            </div>
          </div>
        </div>

      </div>
    `;
    feed.appendChild(postEl);

    // attach behavior
    attachPostBehavior(postEl, post);
  });

  // observe videos for autoplay
  observeVideos();
}

/* AUTOPLAY OBSERVER */
let io;
function observeVideos(){
  if(io) io.disconnect();
  io = new IntersectionObserver((entries)=>{
    entries.forEach(entry=>{
      const vid = entry.target;
      if(entry.isIntersecting && entry.intersectionRatio >= 0.7){
        vid.play().catch(()=>{});
      } else {
        vid.pause();
      }
    });
  }, { threshold: [0.7] });

  document.querySelectorAll('.post video').forEach(v => io.observe(v));
}

/* POST BEHAVIOR: comments, likes, double-tap, drawer anchor inside post */
function attachPostBehavior(postEl, postData){
  const video = postEl.querySelector('video');
  const likeBtn = postEl.querySelector('.like-btn');
  const likeCountEl = postEl.querySelector('.like-count');
  const commentOpen = postEl.querySelector('.comment-open');
  const drawer = postEl.querySelector('.drawer');
  const drawerInner = postEl.querySelector('.drawer-inner');
  const commentsList = postEl.querySelector('.comments-list');
  const drawerHandle = postEl.querySelector('.drawer-handle');
  const commentsHeader = postEl.querySelector('.muted.small.center');
  const commentInputWrap = postEl.querySelector('.comment-input');
  const commentInput = commentInputWrap.querySelector('input');
  const sendBtn = postEl.querySelector('.send-small');

  // populate comments list
  function refreshComments(){
    commentsList.innerHTML = '';
    (postData.comments || []).forEach((c, idx) => {
      const d = document.createElement('div');
      d.className = 'comment';
      d.textContent = c;
      d.dataset.index = idx;
      commentsList.appendChild(d);

      // long-press to reply
      attachLongPress(d, 2000, () => {
        // show input prefilled with reply tag
        commentInputWrap.classList.add('active');
        commentInput.value = `@reply_to: `; // dev can adapt
        commentInput.focus();
        // set reply target
        commentInput.dataset.replyTo = c.split(':')[0] || '';
      });
    });
  }
  refreshComments();

  // open drawer anchored in post
  commentOpen.addEventListener('click', (e)=>{
    e.stopPropagation();
    openDrawer();
  });

  function openDrawer(){
    // close other drawers
    document.querySelectorAll('.drawer.open').forEach(d => { if(d !== drawer) d.classList.remove('open'); d.parentElement.parentElement.setAttribute('aria-hidden','true'); });
    drawer.classList.add('open');
    drawer.setAttribute('aria-hidden','false');
    // hide default input until long press
    commentInputWrap.classList.remove('active');
    commentInput.value = '';
    // scroll comments list to middle (centered-ish)
    setTimeout(()=> drawerInner.scrollTop = 9999, 80);
  }

  function closeDrawer(){
    drawer.classList.remove('open');
    drawer.setAttribute('aria-hidden','true');
    commentInputWrap.classList.remove('active');
    commentInput.value = '';
  }

  // long-press on drawer header (the "Comments" text) to show comment input
  attachLongPress(commentsHeader, 2000, () => {
    commentInputWrap.classList.add('active');
    commentInput.value = '';
    commentInput.focus();
  });

  // long-press on handle to toggle (also allow drag)
  attachLongPress(drawerHandle, 2000, ()=> {
    if(drawer.classList.contains('open')) closeDrawer();
    else openDrawer();
  });

  // clicking outside drawer inside post will close drawer
  postEl.addEventListener('click', (e)=>{
    // if click is not within drawer and drawer is open, close
    if(drawer.classList.contains('open') && !e.target.closest('.drawer')) closeDrawer();
  });

  // send comment (only allowed if input active)
  sendBtn.addEventListener('click', ()=>{
    if(!commentInputWrap.classList.contains('active')) return;
    const val = commentInput.value.trim();
    if(!val) return;
    const newC = `@you: ${val}`;
    postData.comments = postData.comments || [];
    postData.comments.push(newC);
    refreshComments();
    commentInput.value = '';
    // optionally close after send:
    // closeDrawer();
  });

  // like logic: like button increments; double-tap on video increments + show heart
  likeBtn.addEventListener('click', (ev) => {
    ev.stopPropagation();
    postData.likes = (postData.likes || 0) + 1;
    likeCountEl.textContent = postData.likes;
    showHeartForPost(postEl);
  });

  // double-tap detection (pointer)
  let lastTap = 0;
  postEl.addEventListener('pointerup', (ev) => {
    const now = Date.now();
    if(now - lastTap < 300){
      // double-tap
      postData.likes = (postData.likes || 0) + 1;
      likeCountEl.textContent = postData.likes;
      showHeartForPost(postEl);
    }
    lastTap = now;
  });

  // ensure drawer touch scroll is smooth (no scrollbar shown)
  // (CSS handles hiding scrollbar; -webkit-overflow-scrolling: touch helps)
}

/* show heart animation centered on post element */
function showHeartForPost(postEl){
  const rect = postEl.getBoundingClientRect();
  const pageX = rect.left + rect.width / 2;
  const pageY = rect.top + rect.height / 2;
  heartHit.style.left = pageX + 'px';
  heartHit.style.top = pageY + 'px';

  // reset water pos
  const water = document.getElementById('waterRect2');
  const wave = document.getElementById('wave2');
  water.setAttribute('y', 100);
  wave.setAttribute('d', 'M0 80 Q20 70 40 80 T80 80 T120 80 V120 H0 Z');

  heartHit.classList.remove('show');
  // force reflow
  void heartHit.offsetWidth;
  heartHit.classList.add('show');

  // animate water upward
  let start = null; const duration = 700;
  function step(ts){
    if(!start) start = ts;
    const t = Math.min(1, (ts - start)/duration);
    const y = 100 - 110 * t;
    water.setAttribute('y', y);
    const waveY = 80 - 30 * t;
    wave.setAttribute('d', `M0 ${waveY} Q20 ${waveY-10} 40 ${waveY} T80 ${waveY} T120 ${waveY} V120 H0 Z`);
    if(t < 1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);

  setTimeout(()=> heartHit.classList.remove('show'), 1100);
}

/* LONG PRESS HELPER
   element, ms, callback
*/
function attachLongPress(el, ms, cb){
  let timer = null, pointerId = null;
  const start = (e) => {
    if(timer) clearTimeout(timer);
    timer = setTimeout(()=> { cb(e); timer = null; }, ms);
    if(e.pointerId != null) {
      pointerId = e.pointerId;
      el.setPointerCapture?.(pointerId);
    }
  };
  const cancel = (e) => {
    if(timer){ clearTimeout(timer); timer = null; }
    try{ if(pointerId != null) el.releasePointerCapture?.(pointerId); }catch(e){}
    pointerId = null;
  };
  el.addEventListener('pointerdown', start);
  el.addEventListener('pointerup', cancel);
  el.addEventListener('pointercancel', cancel);
  el.addEventListener('pointerleave', cancel);
}

/* HEADER SWIPE THEME TOGGLE (left/right) */
const header = document.getElementById('header');
let pDown = false, pStartX = 0;
header.addEventListener('pointerdown', (e) => {
  pDown = true;
  pStartX = e.clientX;
  header.setPointerCapture?.(e.pointerId);
});
header.addEventListener('pointermove', (e) => {
  if(!pDown) return;
  const dx = e.clientX - pStartX;
  // small visual feedback
  header.style.transform = `translateX(${dx * 0.08}px)`;
});
header.addEventListener('pointerup', (e) => {
  header.style.transform = '';
  if(!pDown) return; pDown = false;
  const dx = e.clientX - pStartX;
  const threshold = 80; // px
  if(dx <= -threshold || dx >= threshold){
    toggleTheme();
  }
});
header.addEventListener('pointercancel', ()=> { pDown = false; header.style.transform = ''; });

function toggleTheme(){
  document.documentElement.classList.toggle('light');
  // small pop animation for header
  header.animate([{ transform:'translateY(-4px)' }, { transform:'translateY(0)' }], { duration:260 });
}

/* FAB modal (simple centered box) - kept minimal (you said Supabase later) */
const fab = document.getElementById('fab');
fab.addEventListener('click', ()=> openUploadPrompt());

// create a simple modal overlay using DOM (non-overlapping)
function openUploadPrompt(){
  // create backdrop
  if(document.getElementById('uploadModal')) return;
  const backdrop = document.createElement('div');
  backdrop.id = 'uploadModal';
  Object.assign(backdrop.style, {
    position:'fixed', inset:0, background:'rgba(2,6,23,0.45)', backdropFilter:'blur(6px) saturate(130%)',
    display:'flex', alignItems:'center', justifyContent:'center', zIndex:60
  });
  const modal = document.createElement('div');
  Object.assign(modal.style, {
    width:'min(720px,92vw)', padding:'20px', borderRadius:'14px', background:'linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01))',
    boxShadow:'0 18px 60px rgba(0,0,0,0.6)', color:'inherit'
  });
  modal.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
      <div><strong style="font-size:18px">Create a Post</strong><div class="muted small" style="margin-top:6px">Videos must be 60s or less. (Demo saves locally)</div></div>
      <button id="closeUpload" style="background:none;border:none;color:inherit;font-size:22px;cursor:pointer">√ó</button>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <button id="recordBtn" style="padding:12px 14px;border-radius:12px;border:none;background:linear-gradient(135deg,var(--accent),#b473ff);color:#fff;cursor:pointer">üé• Record (demo)</button>
      <label style="padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,0.06);display:inline-flex;align-items:center;cursor:pointer">
        üìÅ Upload <input id="filePicker" type="file" accept="video/*" style="display:none" />
      </label>
    </div>
  `;
  backdrop.appendChild(modal);
  document.body.appendChild(backdrop);

  document.getElementById('closeUpload').addEventListener('click', ()=> {
    backdrop.remove();
  });
  document.getElementById('filePicker').addEventListener('change', (e)=>{
    const f = e.target.files[0];
    if(!f) return;
    const tmp = document.createElement('video'); tmp.preload='metadata';
    const url = URL.createObjectURL(f);
    tmp.src = url;
    tmp.onloadedmetadata = ()=> {
      if(tmp.duration > 60){ alert('Video must be 60s or less'); URL.revokeObjectURL(url); return; }
      // add to posts locally (demo)
      const id = 'p' + Math.random().toString(36).slice(2,9);
      posts.unshift({ id, user:'@you', caption:'New post', src:url, likes:0, comments:[] });
      renderFeed();
      backdrop.remove();
    };
  });
  // recordBtn demo: behave like upload with mock
  document.getElementById('recordBtn').addEventListener('click', ()=>{
    alert('Recording demo: use device camera integration for real app.');
  });
}

/* init */
renderFeed();

/* accessibility: ESC to close any open drawers or modals */
document.addEventListener('keydown', (e) => {
  if(e.key === 'Escape'){
    document.querySelectorAll('.drawer.open').forEach(d => d.classList.remove('open'));
    const modal = document.getElementById('uploadModal'); if(modal) modal.remove();
  }
});
</script>
</body>
</html>
